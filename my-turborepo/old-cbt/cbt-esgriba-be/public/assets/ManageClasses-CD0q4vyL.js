var W=Object.defineProperty,X=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var T=(l,t,a)=>t in l?W(l,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[t]=a,f=(l,t)=>{for(var a in t||(t={}))Q.call(t,a)&&T(l,a,t[a]);if(M)for(var a of M(t))Y.call(t,a)&&T(l,a,t[a]);return l},v=(l,t)=>X(l,q(t));var b=(l,t,a)=>new Promise((r,o)=>{var d=c=>{try{h(a.next(c))}catch(g){o(g)}},D=c=>{try{h(a.throw(c))}catch(g){o(g)}},h=c=>c.done?r(c.value):Promise.resolve(c.value).then(d,D);h((a=a.apply(l,t)).next())});import{j as e}from"./vendor-ui-XVksrZ5j.js";import{r as m}from"./vendor-react-DruPVAFJ.js";import{B as j,u as Z,e as w,L as _,I as E}from"./index-BmVdEGiP.js";import{A as ee,D as ae}from"./data-table-qMSffp-C.js";import{D as se,a as te,b as re,d as le,e as ne,c as B}from"./dropdown-menu-BDf3JuuU.js";import{B as O}from"./badge-DVlZ2whw.js";import{U as ie}from"./users-Cv97A8df.js";import{M as ce}from"./more-horizontal-B_tWyvgt.js";import{P as oe}from"./pencil-DR_wvNsn.js";import{T as de}from"./trash-2-SALYx2gF.js";import{D as P,b as F,c as L,d as H,e as A,f as I}from"./dialog-FHcYl0q1.js";import{S as me,a as xe,b as he,c as pe,d as ue}from"./select-CT0oUeJ5.js";import{P as je}from"./plus-BcW2gs2h.js";import"./vendor-utils-DI_-nBMo.js";import"./vendor-charts-BB9d_U7u.js";import"./vendor-table-DRaoTYIa.js";import"./table-BTQg55BV.js";import"./chevron-left-Cico8d1J.js";import"./chevron-right-DGvanUYx.js";import"./check-BFyP0Qeo.js";import"./circle-B_uur8fk.js";import"./chevron-down-CL3T_hsi.js";const ge=(l,t)=>[{accessorKey:"class_name",header:({column:a})=>e.jsxs(j,{variant:"ghost",onClick:()=>a.toggleSorting(a.getIsSorted()==="asc"),className:"hover:bg-slate-100 dark:hover:bg-slate-800 text-xs sm:text-sm p-1 sm:p-4 h-auto",children:["Nama Kelas",e.jsx(ee,{className:"ml-1 sm:ml-2 h-3 w-3 sm:h-4 sm:w-4"})]}),cell:({row:a})=>{var r;return e.jsxs("div",{className:"font-medium text-slate-900 dark:text-white text-xs sm:text-sm min-w-[110px] max-w-[180px] sm:max-w-none",children:[e.jsx("div",{className:"truncate",children:a.getValue("class_name")}),e.jsx("div",{className:"text-[10px] sm:hidden text-slate-500 dark:text-slate-400 truncate mt-0.5",children:((r=a.original.major)==null?void 0:r.major_name)||"-"})]})}},{accessorKey:"major.major_name",header:()=>e.jsx("div",{className:"text-xs sm:text-sm hidden md:table-cell",children:"Jurusan"}),cell:({row:a})=>{const r=a.original.major;return e.jsx(O,{variant:"outline",className:"dark:border-slate-600 dark:text-slate-300 hidden md:inline-flex",children:r?r.major_name:"-"})}},{accessorKey:"homeroom_teacher",header:()=>e.jsx("div",{className:"text-xs sm:text-sm hidden lg:table-cell",children:"Wali Kelas"}),cell:({row:a})=>{const r=a.getValue("homeroom_teacher");return e.jsx("span",{className:"text-slate-600 dark:text-slate-400 hidden lg:inline",children:r||"-"})}},{id:"students",header:()=>e.jsx("div",{className:"text-xs sm:text-sm hidden md:table-cell",children:"Siswa"}),cell:({row:a})=>{const r=a.original.students_count||0,o=a.original.capacity||0,d=o>0?r/o*100:0;return e.jsxs("div",{className:"hidden md:flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4 text-slate-400"}),e.jsxs("span",{className:"text-xs sm:text-sm text-slate-900 dark:text-white",children:[r,o>0&&e.jsxs("span",{className:"text-slate-500 dark:text-slate-400",children:["/",o]})]}),o>0&&e.jsxs(O,{variant:d>=100?"destructive":d>=80?"secondary":"outline",className:"text-[10px]",children:[d.toFixed(0),"%"]})]})}},{id:"actions",header:()=>e.jsx("div",{className:"text-xs sm:text-sm text-center",children:"Aksi"}),cell:({row:a})=>{const r=a.original;return e.jsx("div",{className:"flex justify-center",children:e.jsxs(se,{children:[e.jsx(te,{asChild:!0,children:e.jsxs(j,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-slate-100 dark:hover:bg-slate-800",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(ce,{className:"h-4 w-4"})]})}),e.jsxs(re,{align:"end",className:"bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-700 w-36",children:[e.jsx(le,{className:"dark:text-white text-xs",children:"Aksi"}),e.jsx(ne,{className:"bg-slate-200 dark:bg-slate-700"}),e.jsxs(B,{onClick:()=>l(r),className:"cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-800 dark:text-slate-200 text-xs",children:[e.jsx(oe,{className:"mr-2 h-3 w-3"}),"Edit"]}),e.jsxs(B,{onClick:()=>t(r),className:"cursor-pointer text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/30 text-xs",children:[e.jsx(de,{className:"mr-2 h-3 w-3"}),"Hapus"]})]})]})})}}];function Ve(){const[l,t]=m.useState([]),[a,r]=m.useState([]),[o,d]=m.useState(!1),[D,h]=m.useState(!1),[c,g]=m.useState(null),[S,V]=m.useState(null),[k,y]=m.useState(!1),[G,U]=m.useState(!0),{toast:p}=Z(),[x,N]=m.useState({major_id:"",name:"",capacity:""});m.useEffect(()=>{C(),J()},[]);const C=()=>b(this,null,function*(){var s,i;try{const z=(yield w.get("/classes")).data.data.map(u=>v(f({},u),{class_name:u.class_name||u.name,major:u.major?v(f({},u.major),{major_name:u.major.major_name||u.major.name}):void 0}));t(z)}catch(n){console.error("Error fetching classes:",n),p({title:"Error",description:((i=(s=n.response)==null?void 0:s.data)==null?void 0:i.message)||"Gagal memuat data kelas",variant:"destructive"})}finally{U(!1)}}),J=()=>b(this,null,function*(){var s,i;try{const n=yield w.get("/majors");r(n.data.data)}catch(n){console.error("Error fetching majors:",n),p({title:"Error",description:((i=(s=n.response)==null?void 0:s.data)==null?void 0:i.message)||"Gagal memuat data jurusan",variant:"destructive"})}}),K=s=>{var i;s?(g(s),N({major_id:s.major_id.toString(),name:s.class_name||s.name||"",capacity:((i=s.capacity)==null?void 0:i.toString())||""})):(g(null),N({major_id:"",name:"",capacity:""})),d(!0)},R=()=>b(this,null,function*(){var s,i;y(!0);try{const n={major_id:x.major_id,class_name:x.name,capacity:x.capacity};c?(yield w.put(`/classes/${c.id}`,n),p({title:"Berhasil",description:"Kelas berhasil diperbarui"})):(yield w.post("/classes",n),p({title:"Berhasil",description:"Kelas berhasil ditambahkan"})),d(!1),C()}catch(n){p({title:"Error",description:((i=(s=n.response)==null?void 0:s.data)==null?void 0:i.message)||"Terjadi kesalahan",variant:"destructive"})}finally{y(!1)}}),$=()=>b(this,null,function*(){var s,i;if(S){y(!0);try{yield w.delete(`/classes/${S}`),p({title:"Berhasil",description:"Kelas berhasil dihapus"}),h(!1),C()}catch(n){p({title:"Error",description:((i=(s=n.response)==null?void 0:s.data)==null?void 0:i.message)||"Gagal menghapus kelas",variant:"destructive"})}finally{y(!1)}}});return G?e.jsx("div",{className:"p-6 flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:"Memuat data..."})]})}):e.jsxs("div",{className:"p-3 sm:p-6 pb-20",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-4 mb-4 sm:mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Kelola Kelas"}),e.jsx("p",{className:"text-muted-foreground mt-1 text-sm sm:text-base",children:"Manajemen data kelas dan kapasitas siswa"})]}),e.jsxs(j,{className:"h-9 sm:h-10",onClick:()=>K(),children:[e.jsx(je,{className:"mr-2 h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Tambah Kelas"}),e.jsx("span",{className:"sm:hidden",children:"Tambah"})]})]}),e.jsx(ae,{columns:ge(s=>K(s),s=>{V(s.id),h(!0)}),data:l,searchKey:"class_name",searchPlaceholder:"Cari kelas..."}),e.jsx(P,{open:o,onOpenChange:d,children:e.jsxs(F,{className:"w-[95vw] sm:max-w-[500px]",children:[e.jsxs(L,{children:[e.jsx(H,{children:c?"Edit Kelas":"Tambah Kelas"}),e.jsx(A,{children:c?"Perbarui informasi kelas":"Tambahkan kelas baru ke sistem"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{htmlFor:"major_id",children:"Jurusan"}),e.jsxs(me,{value:x.major_id,onValueChange:s=>N(v(f({},x),{major_id:s})),children:[e.jsx(xe,{id:"major_id",children:e.jsx(he,{placeholder:"Pilih jurusan"})}),e.jsx(pe,{children:a.map(s=>e.jsx(ue,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{htmlFor:"name",children:"Nama Kelas"}),e.jsx(E,{id:"name",value:x.name,onChange:s=>N(v(f({},x),{name:s.target.value})),placeholder:"Contoh: X TKR 1"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{htmlFor:"capacity",children:"Kapasitas"}),e.jsx(E,{id:"capacity",type:"number",value:x.capacity,onChange:s=>N(v(f({},x),{capacity:s.target.value})),placeholder:"Contoh: 32"})]})]}),e.jsxs(I,{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>d(!1),className:"w-full sm:w-auto",children:"Batal"}),e.jsx(j,{type:"submit",onClick:R,disabled:k,className:"w-full sm:w-auto",children:k?"Menyimpan...":"Simpan"})]})]})}),e.jsx(P,{open:D,onOpenChange:h,children:e.jsxs(F,{className:"w-[95vw] sm:max-w-[425px]",children:[e.jsxs(L,{children:[e.jsx(H,{children:"Hapus Kelas?"}),e.jsx(A,{children:"Data kelas akan dihapus permanen. Tindakan ini tidak dapat dibatalkan."})]}),e.jsxs(I,{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(j,{variant:"outline",onClick:()=>h(!1),className:"w-full sm:w-auto",children:"Batal"}),e.jsx(j,{variant:"destructive",onClick:$,disabled:k,className:"w-full sm:w-auto",children:k?"Menghapus...":"Hapus"})]})]})})]})}export{Ve as default};
