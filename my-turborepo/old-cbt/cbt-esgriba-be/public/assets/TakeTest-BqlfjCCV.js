var It=Object.defineProperty,$t=Object.defineProperties;var Pt=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var Oe=Object.prototype.hasOwnProperty,We=Object.prototype.propertyIsEnumerable;var Qe=(n,l,a)=>l in n?It(n,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[l]=a,x=(n,l)=>{for(var a in l||(l={}))Oe.call(l,a)&&Qe(n,a,l[a]);if(oe)for(var a of oe(l))We.call(l,a)&&Qe(n,a,l[a]);return n},w=(n,l)=>$t(n,Pt(l));var P=(n,l)=>{var a={};for(var h in n)Oe.call(n,h)&&l.indexOf(h)<0&&(a[h]=n[h]);if(n!=null&&oe)for(var h of oe(n))l.indexOf(h)<0&&We.call(n,h)&&(a[h]=n[h]);return a};var M=(n,l,a)=>new Promise((h,f)=>{var b=g=>{try{t(a.next(g))}catch(k){f(k)}},_=g=>{try{t(a.throw(g))}catch(k){f(k)}},t=g=>g.done?h(g.value):Promise.resolve(g.value).then(b,_);t((a=a.apply(n,l)).next())});import{i as nt,u as Bt,k as Gt,j as e,l as rt,m as Lt,a as ce,n as be,I as Ut,o as ge,p as Qt,q as Ot,r as Wt}from"./vendor-ui-XVksrZ5j.js";import{r as d,h as Kt,u as Ht}from"./vendor-react-DruPVAFJ.js";import{M as Ke}from"./MathContent-BLSKFKlW.js";import{f as zt,e as U,i as it,u as Vt,B as K,C as He,a as ze,b as Ve,d as Je}from"./index-BmVdEGiP.js";import{C as Jt}from"./circle-B_uur8fk.js";import{T as Xt}from"./textarea-Bx_nRJgZ.js";import{A as le,a as de}from"./alert-BAo0Ym_t.js";import{B as he}from"./badge-DVlZ2whw.js";import{A as Xe,a as Ye,b as Ze,c as et,d as tt,e as st,g as at,f as Yt}from"./alert-dialog-DeGwCm2P.js";import{D as Zt,b as es,c as ts,d as ss,e as as}from"./dialog-FHcYl0q1.js";import{A as ee}from"./alert-circle-Cjt8dlsE.js";import{C as ns}from"./check-circle-BdZ4TSjl.js";import{F as rs}from"./file-text-8Keq495L.js";import{C as is}from"./chevron-left-Cico8d1J.js";import{C as os}from"./chevron-right-DGvanUYx.js";import"./vendor-math-BWdfurLP.js";import"./vendor-utils-DI_-nBMo.js";import"./vendor-charts-BB9d_U7u.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=zt("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),pe={getAttempt:n=>M(void 0,null,function*(){return(yield U.get(`/attempts/${n}`)).data}),logEvent:(n,l)=>M(void 0,null,function*(){return(yield U.post(`/attempts/${n}/events`,l)).data}),monitorTest:n=>M(void 0,null,function*(){return(yield U.get(`/tests/${n}/monitor`)).data}),blockAttempt:(n,l)=>M(void 0,null,function*(){return(yield U.post(`/attempts/${n}/block`,{reason:l})).data}),unblockAttempt:(n,l)=>M(void 0,null,function*(){return(yield U.post(`/attempts/${n}/unblock`,{reason:l})).data})};var we="Radio",[ds,ot]=rt(we),[cs,us]=ds(we),lt=d.forwardRef((n,l)=>{const I=n,{__scopeRadio:a,name:h,checked:f=!1,required:b,disabled:_,value:t="on",onCheck:g,form:k}=I,E=P(I,["__scopeRadio","name","checked","required","disabled","value","onCheck","form"]),[y,R]=d.useState(null),q=be(l,B=>R(B)),j=d.useRef(!1),F=y?k||!!y.closest("form"):!0;return e.jsxs(cs,{scope:a,checked:f,disabled:_,children:[e.jsx(ce.button,w(x({type:"button",role:"radio","aria-checked":f,"data-state":mt(f),"data-disabled":_?"":void 0,disabled:_,value:t},E),{ref:q,onClick:ge(n.onClick,B=>{f||g==null||g(),F&&(j.current=B.isPropagationStopped(),j.current||B.stopPropagation())})})),F&&e.jsx(ut,{control:y,bubbles:!j.current,name:h,value:t,checked:f,required:b,disabled:_,form:k,style:{transform:"translateX(-100%)"}})]})});lt.displayName=we;var dt="RadioIndicator",ct=d.forwardRef((n,l)=>{const _=n,{__scopeRadio:a,forceMount:h}=_,f=P(_,["__scopeRadio","forceMount"]),b=us(dt,a);return e.jsx(Qt,{present:h||b.checked,children:e.jsx(ce.span,w(x({"data-state":mt(b.checked),"data-disabled":b.disabled?"":void 0},f),{ref:l}))})});ct.displayName=dt;var ms="RadioBubbleInput",ut=d.forwardRef((_,b)=>{var t=_,{__scopeRadio:n,control:l,checked:a,bubbles:h=!0}=t,f=P(t,["__scopeRadio","control","checked","bubbles"]);const g=d.useRef(null),k=be(g,b),E=Ot(a),y=Wt(l);return d.useEffect(()=>{const R=g.current;if(!R)return;const q=window.HTMLInputElement.prototype,F=Object.getOwnPropertyDescriptor(q,"checked").set;if(E!==a&&F){const I=new Event("click",{bubbles:h});F.call(R,a),R.dispatchEvent(I)}},[E,a,h]),e.jsx(ce.input,w(x({type:"radio","aria-hidden":!0,defaultChecked:a},f),{tabIndex:-1,ref:k,style:w(x(x({},f.style),y),{position:"absolute",pointerEvents:"none",opacity:0,margin:0})}))});ut.displayName=ms;function mt(n){return n?"checked":"unchecked"}var xs=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],ue="RadioGroup",[fs]=rt(ue,[nt,ot]),xt=nt(),ft=ot(),[hs,ps]=fs(ue),ht=d.forwardRef((n,l)=>{const B=n,{__scopeRadioGroup:a,name:h,defaultValue:f,value:b,required:_=!1,disabled:t=!1,orientation:g,dir:k,loop:E=!0,onValueChange:y}=B,R=P(B,["__scopeRadioGroup","name","defaultValue","value","required","disabled","orientation","dir","loop","onValueChange"]),q=xt(a),j=Bt(k),[F,I]=Gt({prop:b,defaultProp:f!=null?f:null,onChange:y,caller:ue});return e.jsx(hs,{scope:a,name:h,required:_,disabled:t,value:F,onValueChange:I,children:e.jsx(Lt,w(x({asChild:!0},q),{orientation:g,dir:j,loop:E,children:e.jsx(ce.div,w(x({role:"radiogroup","aria-required":_,"aria-orientation":g,"data-disabled":t?"":void 0,dir:j},R),{ref:l}))}))})});ht.displayName=ue;var pt="RadioGroupItem",gt=d.forwardRef((n,l)=>{const q=n,{__scopeRadioGroup:a,disabled:h}=q,f=P(q,["__scopeRadioGroup","disabled"]),b=ps(pt,a),_=b.disabled||h,t=xt(a),g=ft(a),k=d.useRef(null),E=be(l,k),y=b.value===f.value,R=d.useRef(!1);return d.useEffect(()=>{const j=I=>{xs.includes(I.key)&&(R.current=!0)},F=()=>R.current=!1;return document.addEventListener("keydown",j),document.addEventListener("keyup",F),()=>{document.removeEventListener("keydown",j),document.removeEventListener("keyup",F)}},[]),e.jsx(Ut,w(x({asChild:!0},t),{focusable:!_,active:y,children:e.jsx(lt,w(x(x({disabled:_,required:b.required,checked:y},g),f),{name:b.name,ref:E,onCheck:()=>b.onValueChange(f.value),onKeyDown:ge(j=>{j.key==="Enter"&&j.preventDefault()}),onFocus:ge(f.onFocus,()=>{var j;R.current&&((j=k.current)==null||j.click())})}))}))});gt.displayName=pt;var gs="RadioGroupIndicator",bt=d.forwardRef((n,l)=>{const b=n,{__scopeRadioGroup:a}=b,h=P(b,["__scopeRadioGroup"]),f=ft(a);return e.jsx(ct,w(x(x({},f),h),{ref:l}))});bt.displayName=gs;var wt=ht,jt=gt,bs=bt;const kt=d.forwardRef((h,a)=>{var f=h,{className:n}=f,l=P(f,["className"]);return e.jsx(wt,w(x({className:it("grid gap-2",n)},l),{ref:a}))});kt.displayName=wt.displayName;const vt=d.forwardRef((h,a)=>{var f=h,{className:n}=f,l=P(f,["className"]);return e.jsx(jt,w(x({ref:a,className:it("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n)},l),{children:e.jsx(bs,{className:"flex items-center justify-center",children:e.jsx(Jt,{className:"h-2.5 w-2.5 fill-current text-current"})})}))});vt.displayName=jt.displayName;const ws=1,js=["base","lg","xl"];function Ls(){var Se,Ae,Re,qe,Ee,De,Te,Me,Fe,Ie,$e,Pe,Be,Ge,Le;const{id:n}=Kt(),l=Ht(),{toast:a}=Vt(),[h,f]=d.useState(!0),[b,_]=d.useState(!1),[t,g]=d.useState(null),[k,E]=d.useState(0),[y,R]=d.useState({}),[q,j]=d.useState(0),[F,I]=d.useState(!1),[B,te]=d.useState(!1),[je,J]=d.useState(!1),[se,X]=d.useState(0),[ks,yt]=d.useState(null),[ke,Nt]=d.useState({}),[ae,_t]=d.useState("base"),[Ct,V]=d.useState(!1),[Y,ne]=d.useState(null),ve=d.useRef({}),ye=d.useRef({}),D=d.useRef(!1),Q=d.useCallback(s=>{if(!Array.isArray(s.answers))return;const r=s.answers.reduce((i,o)=>{const m={question_id:o.question_id};return typeof o.option_id=="number"&&(m.option_id=o.option_id),typeof o.answer_text=="string"&&o.answer_text.length>0&&(m.answer_text=o.answer_text),i[o.question_id]=m,i},{});return R(i=>x(x({},r),i)),r},[]),O=d.useCallback(s=>{var r;g(i=>{var o,m;return i&&(o=i.test)!=null&&o.questions&&!((m=s.test)!=null&&m.questions)?w(x({},s),{test:w(x({},s.test),{questions:i.test.questions})}):s}),Q(s),je||(ne({count:(r=s.cheat_count)!=null?r:0,reason:s.blocked_reason||void 0}),V(!0),J(!0))},[je,Q]),Ne=d.useCallback(()=>M(this,null,function*(){var s,r,i,o,m,C,T,W,$,c,N,p,v,H;if(console.log("ðŸ”µ startTest called"),D.current){console.log("ðŸ”µ Already loaded, skipping");return}D.current=!0;try{if(!n)throw D.current=!1,new Error("ID ujian tidak ditemukan");f(!0),console.log("ðŸ”µ Fetching test data...");const A=yield U.post(`/tests/${n}/start`);console.log("ðŸ”µ Response received:",A.status);const u=A.data.attempt||A.data;if(console.log("ðŸ”µ Attempt data:",u),!u)throw D.current=!1,new Error("Data attempt tidak ditemukan");if(!u.test)throw D.current=!1,new Error("Data test tidak ditemukan");if(!u.test.questions||!Array.isArray(u.test.questions))throw console.error("Questions data:",u.test.questions),D.current=!1,new Error("Data soal tidak ditemukan atau format tidak valid");if(u.test.questions.length===0)throw D.current=!1,new Error("Ujian ini belum memiliki soal");console.log("ðŸ”µ Setting attempt data..."),console.log("ðŸ”µ Attempt before setState:",{id:u.id,hasTest:!!u.test,hasQuestions:!!((s=u.test)!=null&&s.questions),questionsLength:(i=(r=u.test)==null?void 0:r.questions)==null?void 0:i.length}),g(u);const z=(o=Q(u))!=null?o:{};if(X((m=u.cheat_count)!=null?m:0),J(!1),console.log("ðŸ”µ Data set successfully"),u.test.questions.length>0){const L=u.test.questions.findIndex(ie=>!z[ie.id]);E(L===-1?0:L)}else E(0);j(re(u)),a({title:"Ujian dimulai",description:`Waktu mengerjakan: ${u.test.duration} menit. Total ${u.test.questions.length} soal.`}),(u.is_blocked||u.status==="blocked")&&O(u)}catch(A){if(((C=A.response)==null?void 0:C.status)===423&&((W=(T=A.response)==null?void 0:T.data)!=null&&W.attempt)){console.log("ðŸ”µ Handling 423 blocked attempt");const u=A.response.data.attempt;g(L=>{var ie,Ue;return L&&(ie=L.test)!=null&&ie.questions&&!((Ue=u.test)!=null&&Ue.questions)?w(x({},u),{test:w(x({},u.test),{questions:L.test.questions})}):u});const z=($=Q(u))!=null?$:{};R(z),X((c=u.cheat_count)!=null?c:0),j(re(u)),ne({count:(N=u.cheat_count)!=null?N:0,reason:u.blocked_reason||void 0}),V(!0),J(!0);return}console.error("Error starting test:",A),console.error("Error details:",(p=A.response)==null?void 0:p.data),D.current=!1,a({variant:"destructive",title:"Error",description:((H=(v=A.response)==null?void 0:v.data)==null?void 0:H.message)||A.message||"Gagal memulai ujian"}),setTimeout(()=>{l("/tests")},3e3)}finally{console.log("ðŸ”µ Finally block - setting loading to false"),f(!1)}}),[O,Q,n,l,a]);d.useEffect(()=>{if(console.log("ðŸŸ¢ useEffect startTest triggered, id:",n,"hasLoaded:",D.current),!n){console.log("ðŸŸ¢ No id, skipping");return}if(D.current){console.log("ðŸŸ¢ Already loaded successfully, skipping");return}console.log("ðŸŸ¢ Calling startTest()"),Ne()},[n]),d.useEffect(()=>{if(q<=0||!t||t.status!=="in_progress"||t.is_blocked)return;const s=setInterval(()=>{j(r=>r<=1?(Ce(!0),0):r-1)},1e3);return()=>clearInterval(s)},[q,t]);const St=d.useCallback(s=>M(this,null,function*(){if(!(!t||t.is_blocked))try{te(!0),yield U.post(`/attempts/${t.id}/answer`,s)}catch(r){console.error("Failed to save answer:",r)}finally{te(!1)}}),[t]),me=d.useCallback((s,r)=>M(this,null,function*(){var m,C,T,W,$,c,N;if(!t||t.status!=="in_progress"||t.is_blocked)return;const i=Date.now(),o=(m=ve.current[s])!=null?m:0;if(!(i-o<5e3)){ve.current[s]=i;try{const p=yield pe.logEvent(t.id,{event_type:s,description:r}),v=p==null?void 0:p.attempt;if(typeof(p==null?void 0:p.cheat_count)=="number"&&p.cheat_count>se&&(ne({count:p.cheat_count}),V(!0),X(p.cheat_count)),p!=null&&p.auto_blocked&&v){O(v);return}v&&(v.is_blocked||v.status==="blocked"?O(v):(g(H=>{var A,u;return H&&(A=H.test)!=null&&A.questions&&!((u=v.test)!=null&&u.questions)?w(x({},v),{test:w(x({},v.test),{questions:H.test.questions})}):v}),typeof v.cheat_count=="number"&&X(v.cheat_count)))}catch(p){((C=p==null?void 0:p.response)==null?void 0:C.status)===423&&((W=(T=p.response)==null?void 0:T.data)!=null&&W.attempt)?O(p.response.data.attempt):(($=p==null?void 0:p.response)==null?void 0:$.status)===403?yt(((N=(c=p.response)==null?void 0:c.data)==null?void 0:N.message)||"Anda tidak memiliki izin untuk melakukan aksi ini."):console.error("Failed to log attempt event",p)}}}),[t,O,se,a]),At=d.useCallback(()=>M(this,null,function*(){if(!t||t.is_blocked)return;const s=ye.current;Object.keys(s).forEach(i=>{try{window.clearTimeout(s[Number(i)])}catch(o){}delete s[Number(i)]});const r=Object.values(y);if(r.length!==0)try{te(!0),yield Promise.allSettled(r.map(i=>U.post(`/attempts/${t.id}/answer`,i)))}catch(i){console.error("Failed to flush answers before finish",i)}finally{te(!1)}}),[y,t]);d.useEffect(()=>{if(!t||t.status!=="in_progress"||t.is_blocked)return;let s=null,r=null;const i=()=>{s=setTimeout(()=>{document.hidden&&me("window_blur","Jendela ujian kehilangan fokus")},2e3)},o=()=>{s&&(clearTimeout(s),s=null)},m=()=>{document.hidden?r=setTimeout(()=>{document.hidden&&me("tab_hidden","Tab ujian tidak aktif")},1e3):r&&(clearTimeout(r),r=null)};return window.addEventListener("blur",i),window.addEventListener("focus",o),document.addEventListener("visibilitychange",m),()=>{window.removeEventListener("blur",i),window.removeEventListener("focus",o),document.removeEventListener("visibilitychange",m),s&&clearTimeout(s),r&&clearTimeout(r)}},[t,me]),d.useEffect(()=>{t&&typeof t.cheat_count=="number"&&(t.cheat_count>se&&(ne({count:t.cheat_count}),V(!0)),X(t.cheat_count))},[t,se,a]),d.useEffect(()=>{if(!t||t.status!=="in_progress"&&t.status!=="blocked")return;let s=!0;const r=t.id,i=!!(t.is_blocked||t.status==="blocked"),o=()=>M(this,null,function*(){var C,T,W;try{const $=yield pe.getAttempt(r),c=($==null?void 0:$.attempt)||$;if(console.log("ðŸŸ¡ syncAttempt response:",{hasUpdatedAttempt:!!c,hasTest:!!(c!=null&&c.test),hasQuestions:!!((C=c==null?void 0:c.test)!=null&&C.questions),questionsLength:(W=(T=c==null?void 0:c.test)==null?void 0:T.questions)==null?void 0:W.length}),!s||!c)return;if(!c.test||!Array.isArray(c.test.questions)||c.test.questions.length===0){console.warn("Sync received invalid test data (no questions), keeping current state");return}if(c.is_blocked||c.status==="blocked"){O(c);return}if(i){J(!1),g(N=>{var p,v;return N&&(p=N.test)!=null&&p.questions&&!((v=c.test)!=null&&v.questions)?w(x({},c),{test:w(x({},c.test),{questions:N.test.questions})}):c}),Array.isArray(c.answers)&&c.answers.length>0&&Q(c),j(re(c));return}J(!1),g(N=>{if(!N)return c;if(!(c.cheat_count!==N.cheat_count||c.status!==N.status||c.last_activity_at!==N.last_activity_at))return N;const v=(()=>{var L;if(!c.test)return N.test;const z=c.test.questions;return w(x(x({},N.test),c.test),{questions:Array.isArray(z)&&z.length>0?z:((L=N.test)==null?void 0:L.questions)||[]})})(),u=c,{test:H}=u,A=P(u,["test"]);return w(x(x({},N),A),{test:v,answers:c.answers||N.answers})}),Array.isArray(c.answers)&&c.answers.length>0&&Q(c),j(re(c))}catch($){console.error("Failed to sync attempt status:",$)}});o();const m=window.setInterval(o,i?2e3:5e3);return()=>{s=!1,window.clearInterval(m)}},[t==null?void 0:t.id,t==null?void 0:t.status,t==null?void 0:t.is_blocked,O,Q,n,Ne]);const _e=(s,r,i)=>{const o=x({question_id:s},i==="option"?{option_id:parseInt(r)}:{answer_text:r});R(C=>w(x({},C),{[s]:o}));const m=ye.current;m[s]&&window.clearTimeout(m[s]),m[s]=window.setTimeout(()=>{const C=y[s]||o;St(C),delete m[s]},600)},Rt=d.useCallback(s=>{Nt(r=>{const i=x({},r);return i[s]?delete i[s]:i[s]=!0,i})},[]),Ce=(s=!1)=>M(this,null,function*(){var r,i;if(t){if(t.is_blocked||t.status==="blocked"){a({variant:"destructive",title:"Ujian diblokir",description:t.blocked_reason||"Attempt Anda diblokir oleh pengawas. Jawaban tidak dapat dikirim."});return}try{_(!0),yield At(),yield U.post(`/attempts/${t.id}/finish`),a({title:s?"Waktu habis":"Ujian selesai",description:"Jawaban Anda telah tersimpan"}),l(`/results/${t.id}`)}catch(o){a({variant:"destructive",title:"Error",description:((i=(r=o.response)==null?void 0:r.data)==null?void 0:i.message)||"Gagal mengirim jawaban"})}finally{_(!1),I(!1)}}}),qt=d.useCallback(()=>M(this,null,function*(){var s,r,i;if(V(!1),!!(t!=null&&t.id))try{console.log("ðŸ”„ Reloading attempt data after warning dialog closed...");const o=yield pe.getAttempt(t.id);o.data&&(console.log("âœ… Fresh data loaded:",{status:o.data.status,isBlocked:o.data.is_blocked,hasQuestions:!!((s=o.data.test)!=null&&s.questions),questionsCount:(i=(r=o.data.test)==null?void 0:r.questions)==null?void 0:i.length}),g(m=>{var C,T;return m&&(C=m.test)!=null&&C.questions&&!((T=o.data.test)!=null&&T.questions)?w(x({},o.data),{test:w(x({},o.data.test),{questions:m.test.questions})}):o.data}),!o.data.is_blocked&&o.data.status==="in_progress"&&a({title:"Ujian dilanjutkan",description:"Anda dapat melanjutkan mengerjakan soal."}))}catch(o){console.error("Failed to reload attempt:",o)}}),[t==null?void 0:t.id,a]),Et=s=>{const r=Math.floor(s/3600),i=Math.floor(s%3600/60),o=s%60;return r>0?`${r}:${i.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`:`${i}:${o.toString().padStart(2,"0")}`},Dt=()=>q<300?"text-red-600":q<600?"text-yellow-600":"text-green-600",re=s=>{try{const r=s.test,o=(m=>m?m.replace(" ","T"):void 0)(r.end_time);if(o){const m=new Date(o);if(!Number.isNaN(m.getTime())){const C=m.getTime()-Date.now();return Math.max(0,Math.floor(C/1e3))}}if(s.started_at&&r.duration){const m=new Date(s.started_at).getTime(),C=r.duration*60*1e3,T=m+C-Date.now();return Math.max(0,Math.floor(T/1e3))}}catch(r){console.warn("Gagal menghitung sisa waktu jadwal",r)}return 0},Z=()=>Object.values(y).filter(s=>{const r=typeof s.option_id=="number"&&!Number.isNaN(s.option_id),i=typeof s.answer_text=="string"&&s.answer_text.trim().length>0;return r||i}).length,S=(Ae=(Se=t==null?void 0:t.test)==null?void 0:Se.questions)==null?void 0:Ae[k],G=((qe=(Re=t==null?void 0:t.test)==null?void 0:Re.questions)==null?void 0:qe.length)||0,Tt=k===G-1,Mt=k===0,Ft=!!(t!=null&&t.is_blocked||(t==null?void 0:t.status)==="blocked");(Ee=t==null?void 0:t.cheat_count)!=null,console.log("ðŸŸ£ Render check:",{loading:h,hasAttempt:!!t,hasTest:!!(t!=null&&t.test),questionsLength:(Te=(De=t==null?void 0:t.test)==null?void 0:De.questions)==null?void 0:Te.length,currentQuestionIndex:k,currentQuestion:!!S,hasLoadedSuccessfully:D.current});const xe={base:"text-base",lg:"text-lg",xl:"text-xl"},fe=S?!!ke[S.id]:!1;return h?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Memuat ujian..."})]})}):!t||!t.test?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] gap-4",children:[e.jsxs(le,{variant:"destructive",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx(de,{children:"Data ujian tidak ditemukan. Silakan kembali ke daftar ujian."})]}),e.jsx(K,{onClick:()=>l("/tests"),children:"Kembali ke Daftar Ujian"})]}):Ft&&t?e.jsx(e.Fragment,{children:e.jsx(Zt,{open:!0,children:e.jsxs(es,{className:"max-w-sm",children:[e.jsxs(ts,{children:[e.jsx(ss,{className:"text-red-600",children:"Ujian Diblokir"}),e.jsx(as,{children:t.blocked_reason||"Pengawas memblokir attempt ini karena aktivitas mencurigakan."})]}),e.jsx("div",{className:"space-y-3 text-sm text-gray-600",children:e.jsx("p",{children:"Hubungi guru atau pengawas untuk membuka blokir. Setelah blokir dicabut, halaman ini akan otomatis melanjutkan ujian tanpa perlu refresh."})})]})})}):!h&&!D.current&&t&&(!t.test.questions||!Array.isArray(t.test.questions)||t.test.questions.length===0)?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] gap-4",children:[e.jsxs(le,{variant:"destructive",className:"max-w-md",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx(de,{children:"Ujian ini belum memiliki soal. Silakan hubungi guru untuk menambahkan soal terlebih dahulu."})]}),e.jsx(K,{onClick:()=>l("/tests"),children:"Kembali ke Daftar Ujian"})]}):!h&&!D.current&&t&&G>0&&!S?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] gap-4",children:[e.jsxs(le,{variant:"destructive",className:"max-w-md",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx(de,{children:"Soal tidak dapat dimuat. Silakan refresh halaman atau hubungi administrator."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{variant:"outline",onClick:()=>window.location.reload(),children:"Refresh Halaman"}),e.jsx(K,{onClick:()=>l("/tests"),children:"Kembali ke Daftar Ujian"})]})]}):S?e.jsxs(e.Fragment,{children:[e.jsx(Xe,{open:Ct,onOpenChange:V,children:e.jsxs(Ye,{className:"max-w-md",children:[e.jsxs(Ze,{children:[e.jsxs(et,{className:"text-red-600 flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5"}),"Peringatan Kecurangan"]}),e.jsxs(tt,{className:"space-y-3",children:[e.jsx("p",{children:"Sistem mendeteksi aktivitas mencurigakan pada ujian Anda."}),Y&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 space-y-2",children:Y.reason&&e.jsxs("p",{className:"text-sm text-red-800",children:["Alasan: ",Y.reason]})}),e.jsx("p",{className:"text-sm",children:"Anda masih dapat melanjutkan ujian, namun aktivitas Anda sedang dipantau. Hindari tindakan mencurigakan untuk mencegah ujian diblokir secara permanen."}),Y&&Y.count>=ws&&e.jsx("p",{className:"text-sm font-semibold text-red-600",children:"âš ï¸ Peringatan maksimal tercapai! Satu pelanggaran lagi akan memblokir ujian Anda."})]})]}),e.jsx(st,{children:e.jsx(at,{onClick:qt,className:"bg-blue-600 hover:bg-blue-700",children:"Saya Mengerti, Lanjutkan Ujian"})})]})}),e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-slate-100 via-white to-slate-100 px-3 py-4 md:px-6 md:py-6",children:e.jsxs("div",{className:"mx-auto flex w-full max-w-6xl flex-col gap-4 md:gap-6",children:[e.jsx("div",{className:"flex flex-col items-center gap-2 text-center px-2",children:e.jsx(he,{variant:"outline",className:"rounded-full border-blue-200 bg-blue-50 text-blue-700 text-xs md:text-sm",children:"Ujian Berlangsung"})}),e.jsxs("div",{className:"overflow-hidden rounded-2xl md:rounded-3xl border border-slate-100 bg-white/95 shadow-[0_20px_60px_-30px_rgba(30,64,175,0.45)]",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4 p-4 md:gap-6 md:p-6 text-center",children:[e.jsxs("div",{className:"relative flex w-full max-w-xs flex-col items-center gap-1 rounded-2xl md:rounded-3xl bg-slate-900 px-4 py-3 md:px-6 md:py-4 text-white shadow-lg",children:[e.jsx("span",{className:"text-xs md:text-sm font-medium text-slate-200",children:"Sisa Waktu"}),e.jsx("span",{className:`text-2xl md:text-3xl font-semibold tracking-tight ${Dt()}`,children:Et(q)})]}),B&&e.jsx("span",{className:"text-center text-xs font-medium text-blue-500",children:"Menyimpan jawaban..."}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-2 text-xs font-medium text-slate-500",children:[e.jsx("span",{children:"Ukuran Font Soal:"}),js.map(s=>e.jsx("button",{type:"button",onClick:()=>_t(s),className:`rounded-full border px-3 py-1 transition ${ae===s?"border-blue-500 bg-blue-50 text-blue-600":"border-slate-200 bg-white text-slate-500 hover:border-blue-300"}`,children:s==="base"?"A":s==="lg"?"A+":"A++"},s))]})]}),e.jsx("div",{className:"border-t border-slate-100 bg-slate-50/60 px-3 py-3 md:px-6 md:py-4",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 md:gap-3 text-xs md:text-sm text-slate-600 md:flex-row md:justify-between",children:[e.jsxs("div",{className:"flex flex-col items-center gap-1 md:flex-row md:items-center md:gap-3",children:[e.jsxs("span",{className:"font-medium text-slate-900 text-xs md:text-sm",children:["Soal ",k+1," dari ",G]}),e.jsx("span",{className:"hidden h-1.5 w-1.5 rounded-full bg-slate-300 md:inline-block","aria-hidden":!0}),e.jsxs("span",{className:"text-center",children:["Terjawab ",Z()," / ",G]})]}),e.jsx("div",{className:"h-2 w-full overflow-hidden rounded-full bg-slate-200 md:w-72",children:e.jsx("div",{className:"h-full rounded-full bg-gradient-to-r from-blue-500 via-indigo-500 to-sky-500 transition-all duration-500",style:{width:`${G>0?Math.min(100,Z()/G*100):0}%`}})})]})})]}),e.jsxs("div",{className:"grid gap-4 md:gap-6 lg:grid-cols-[360px_1fr]",children:[e.jsxs(He,{className:"border-0 bg-white/90 shadow-xl shadow-slate-900/5 min-w-0",children:[e.jsx(ze,{className:"pb-3 px-4 pt-4 md:px-6 md:pt-6",children:e.jsxs(Ve,{className:"text-sm md:text-base font-semibold text-slate-800",children:["Navigasi Soal (",((Fe=(Me=t==null?void 0:t.test)==null?void 0:Me.questions)==null?void 0:Fe.length)||0,")"]})}),e.jsx(Je,{className:"pb-4 px-4 md:pb-6 md:px-6 min-w-0",children:e.jsx("div",{className:"w-full min-w-0 overflow-x-auto overflow-y-hidden pb-2 -mx-1 px-1 scrollbar-hide touch-pan-x scroll-smooth md:overflow-visible",children:e.jsx("div",{className:"flex w-max flex-nowrap gap-2 pr-4 md:w-auto md:flex-wrap md:pr-0",children:(((Ie=t==null?void 0:t.test)==null?void 0:Ie.questions)||[]).map((s,r)=>{const i=!!y[s.id],o=r===k,m=ke[s.id];return e.jsxs("button",{type:"button",onClick:()=>E(r),className:`relative flex h-10 w-10 md:h-12 md:w-12 flex-shrink-0 items-center justify-center rounded-xl border text-xs md:text-sm font-medium transition ${o?"border-blue-600 bg-blue-600 text-white shadow-lg":i?"border-green-100 bg-green-50 text-green-700":"border-slate-200 bg-white text-slate-600 hover:border-blue-300"}`,children:[r+1,m&&e.jsx("span",{className:"absolute -top-1 -right-1 h-3.5 w-3.5 rounded-full border-2 border-white bg-amber-500"}),i&&!o&&!m&&e.jsx(ns,{className:"absolute -top-1 -right-1 h-4 w-4 text-green-500"})]},s.id)})})})})]}),e.jsxs("div",{className:"space-y-3 md:space-y-4",children:[e.jsxs(He,{className:"overflow-hidden border-0 bg-white/95 shadow-xl shadow-slate-900/5",children:[e.jsxs(ze,{className:"border-b border-slate-100 pb-3 px-4 pt-4 md:pb-4 md:px-6 md:pt-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 md:gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[e.jsxs(he,{className:"rounded-full bg-blue-100 text-blue-700 text-xs md:text-sm px-2 py-1 md:px-3",children:["Soal No ",k+1]}),S.question_type==="essay"&&e.jsxs(he,{variant:"outline",className:"rounded-full bg-purple-50 text-purple-600",children:[e.jsx(rs,{className:"mr-1 h-3 w-3"})," Essay"]})]}),fe&&e.jsx("span",{className:"inline-flex items-center gap-2 rounded-full bg-amber-100 px-3 py-1 text-xs font-medium text-amber-700",children:"Ditandai ragu-ragu"})]}),e.jsx(Ve,{className:`mt-2 md:mt-3 font-semibold text-slate-900 ${xe[ae]} leading-snug break-words`,style:{overflowWrap:"anywhere",wordBreak:"break-word"},children:e.jsx("span",{className:"prose max-w-none break-words",style:{overflowWrap:"anywhere",wordBreak:"break-word"},children:e.jsx(Ke,{content:S.question_text})})})]}),e.jsxs(Je,{className:"space-y-4 md:space-y-5 py-4 px-4 md:py-6 md:px-6",children:[S.question_type==="multiple_choice"&&S.options&&e.jsx(kt,{value:(Pe=($e=y[S.id])==null?void 0:$e.option_id)==null?void 0:Pe.toString(),onValueChange:s=>_e(S.id,s,"option"),className:"space-y-3",children:S.options.map((s,r)=>{var i;return e.jsxs("label",{htmlFor:`option-${s.id}`,className:`group relative flex cursor-pointer items-center gap-4 rounded-2xl border p-4 transition ${((i=y[S.id])==null?void 0:i.option_id)===s.id?"border-blue-500 bg-blue-50/80 shadow-lg shadow-blue-200":"border-slate-200 bg-white hover:border-blue-300 hover:bg-blue-50/40"}`,children:[e.jsx(vt,{value:s.id.toString(),id:`option-${s.id}`,className:"sr-only"}),e.jsx("span",{className:"flex h-10 w-10 items-center justify-center rounded-full border border-slate-200 bg-white text-sm font-semibold text-slate-600 group-hover:border-blue-400 group-hover:text-blue-600 flex-shrink-0",children:String.fromCharCode(65+r)}),e.jsx("span",{className:`flex-1 text-slate-700 ${xe[ae]} prose max-w-none break-words min-w-0`,style:{overflowWrap:"anywhere",wordBreak:"break-word"},children:e.jsx(Ke,{content:s.option_text})})]},s.id)})}),S.question_type==="essay"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Xt,{placeholder:"Ketik jawaban Anda di sini...",className:`min-h-[220px] rounded-2xl border-slate-200 bg-slate-50/60 ${xe[ae]}`,value:((Be=y[S.id])==null?void 0:Be.answer_text)||"",onChange:s=>_e(S.id,s.target.value,"text")}),e.jsxs("p",{className:"text-xs font-medium text-slate-500",children:[((Le=(Ge=y[S.id])==null?void 0:Ge.answer_text)==null?void 0:Le.length)||0," ","karakter"]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 md:gap-3 border-t border-slate-100 bg-slate-50/70 p-3 md:p-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(K,{variant:"outline",size:"default",onClick:()=>E(s=>Math.max(0,s-1)),disabled:Mt,className:"flex-1 md:flex-none group gap-1 md:gap-2 rounded-full border-slate-300 px-3 md:px-5 text-xs md:text-sm",children:[e.jsx(is,{className:"h-3 w-3 md:h-4 md:w-4"}),"Sebelumnya"]}),e.jsx(K,{type:"button",variant:"outline",size:"default",onClick:()=>Rt(S.id),className:`flex-1 md:flex-none gap-1 md:gap-2 rounded-full px-3 md:px-5 text-xs md:text-sm ${fe?"border-amber-400 bg-amber-100 text-amber-700":"border-slate-300 text-slate-600 hover:border-amber-400 hover:text-amber-600"}`,children:fe?"Batal Ragu":"Tandai Ragu"})]}),e.jsx("div",{className:"flex gap-2 w-full md:w-auto",children:Tt?e.jsxs(K,{size:"default",onClick:()=>I(!0),className:"w-full md:w-auto gap-1 md:gap-2 rounded-full bg-emerald-600 px-4 md:px-6 text-xs md:text-sm text-white shadow-md hover:bg-emerald-700",disabled:b,children:[e.jsx(ls,{className:"h-3 w-3 md:h-4 md:w-4"}),b?"Mengirim...":"Selesai & Kirim"]}):e.jsxs(K,{size:"default",onClick:()=>E(s=>s+1),className:"w-full md:w-auto gap-1 md:gap-2 rounded-full bg-blue-600 px-4 md:px-6 text-xs md:text-sm text-white shadow-md hover:bg-blue-700",children:["Selanjutnya",e.jsx(os,{className:"h-3 w-3 md:h-4 md:w-4"})]})})]})]}),q<300&&e.jsxs(le,{variant:"destructive",className:"rounded-2xl border-0 bg-red-50 text-red-700",children:[e.jsx(ee,{className:"h-5 w-5"}),e.jsx(de,{className:"text-sm font-medium",children:"Waktu Anda tersisa kurang dari 5 menit. Segera selesaikan ujian."})]})]})]}),e.jsx(Xe,{open:F,onOpenChange:I,children:e.jsxs(Ye,{children:[e.jsxs(Ze,{children:[e.jsx(et,{children:"Kirim Jawaban?"}),e.jsxs(tt,{children:["Anda telah menjawab ",Z()," dari ",G," ","soal.",Z()<G&&e.jsxs("span",{className:"mt-2 block text-amber-600",children:["âš ï¸ Masih ada ",G-Z()," soal yang belum dijawab!"]}),e.jsx("span",{className:"mt-2 block",children:"Setelah dikirim, Anda tidak dapat mengubah jawaban lagi."})]})]}),e.jsxs(st,{children:[e.jsx(Yt,{disabled:b,children:"Batal"}),e.jsx(at,{onClick:()=>Ce(!1),disabled:b,className:"bg-emerald-600 hover:bg-emerald-700",children:b?"Mengirim...":"Ya, Kirim Sekarang"})]})]})})]})})]}):e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Memuat soal..."})]})})}export{Ls as default};
