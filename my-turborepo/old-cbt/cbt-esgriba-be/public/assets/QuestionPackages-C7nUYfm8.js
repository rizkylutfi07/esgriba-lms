var Ce=Object.defineProperty,_e=Object.defineProperties;var Pe=Object.getOwnPropertyDescriptors;var ae=Object.getOwnPropertySymbols;var De=Object.prototype.hasOwnProperty,Te=Object.prototype.propertyIsEnumerable;var se=(o,l,i)=>l in o?Ce(o,l,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[l]=i,g=(o,l)=>{for(var i in l||(l={}))De.call(l,i)&&se(o,i,l[i]);if(ae)for(var i of ae(l))Te.call(l,i)&&se(o,i,l[i]);return o},v=(o,l)=>_e(o,Pe(l));var y=(o,l,i)=>new Promise((E,A)=>{var f=h=>{try{u(i.next(h))}catch(B){A(B)}},L=h=>{try{u(i.throw(h))}catch(B){A(B)}},u=h=>h.done?E(h.value):Promise.resolve(h.value).then(f,L);u((i=i.apply(o,l)).next())});import{j as e}from"./vendor-ui-XVksrZ5j.js";import{u as Ee,r as d}from"./vendor-react-DruPVAFJ.js";import{u as Be,h as Me,B as S,C as O,d as K,I as te,L as M}from"./index-BmVdEGiP.js";import{T as Ie,a as Ae,b as le,c as k,d as qe,e as w}from"./table-BTQg55BV.js";import{D as ie,a as re,b as ne,c as C,e as de}from"./dropdown-menu-BDf3JuuU.js";import{D as Ge,b as Fe,c as Ve,d as $e,e as ze,f as He}from"./dialog-FHcYl0q1.js";import{S as _,a as P,b as D,c as T,d as c}from"./select-CT0oUeJ5.js";import{T as Oe}from"./textarea-Bx_nRJgZ.js";import{B as ce}from"./badge-DVlZ2whw.js";import{q as I}from"./questionPackageService-DdsMbR7c.js";import{m as oe}from"./masterDataService-BT0EDdvP.js";import{P as me}from"./plus-BcW2gs2h.js";import{S as Ke}from"./search-NdQjMSfE.js";import{P as U}from"./package-CqcFhlWf.js";import{M as ue}from"./more-vertical-BMsgZsCU.js";import{E as Le}from"./eye-ErUhf9Bf.js";import{P as he}from"./pen-square-DdkHHRrl.js";import{C as xe}from"./copy-pRjNeCAu.js";import{T as je}from"./trash-2-SALYx2gF.js";import"./vendor-utils-DI_-nBMo.js";import"./vendor-charts-BB9d_U7u.js";import"./chevron-right-DGvanUYx.js";import"./check-BFyP0Qeo.js";import"./circle-B_uur8fk.js";import"./chevron-down-CL3T_hsi.js";const pe={easy:"Mudah",medium:"Sedang",hard:"Sulit"},fe={easy:"bg-green-500/10 text-green-700 dark:bg-green-500/20 dark:text-green-400",medium:"bg-yellow-500/10 text-yellow-700 dark:bg-yellow-500/20 dark:text-yellow-400",hard:"bg-red-500/10 text-red-700 dark:bg-red-500/20 dark:text-red-400"};function ba(){var ee;const o=Ee(),{toast:l}=Be(),{user:i}=Me(),[E,A]=d.useState([]),[f,L]=d.useState([]),[u,h]=d.useState([]),[B,W]=d.useState(!1),[q,be]=d.useState(""),[b,Ne]=d.useState("all"),[G,ge]=d.useState("all"),[x,F]=d.useState("all"),[ve,Q]=d.useState(!1),[V,R]=d.useState(null),[r,j]=d.useState({name:"",description:"",subject_id:0,difficulty_level:"medium",teacher_id:void 0}),m=(i==null?void 0:i.role)==="admin";d.useEffect(()=>{z()},[b,G,x,q]),d.useEffect(()=>{ye()},[]),d.useEffect(()=>{m&&Se()},[m]),d.useEffect(()=>{!m&&x!=="all"&&F("all")},[m,x]);const $=d.useMemo(()=>{if(!m)return[];if(b==="all")return u;const a=Number.parseInt(b,10);return Number.isNaN(a)?u:u.filter(t=>(t.subjects||[]).some(s=>s.id===a))},[m,u,b]);d.useEffect(()=>{if(!m||x==="all")return;const a=Number.parseInt(x,10);if(Number.isNaN(a)){F("all");return}$.some(s=>s.id===a)||F("all")},[$,m,x]);const z=()=>y(this,null,function*(){var a,t;try{W(!0);const s={};b!=="all"&&(s.subject_id=Number.parseInt(b,10)),G!=="all"&&(s.difficulty_level=G),q&&(s.search=q),m&&x!=="all"&&(s.teacher_id=Number.parseInt(x,10));const n=yield I.getAll(s);A(n.data)}catch(s){l({title:"Error",description:((t=(a=s.response)==null?void 0:a.data)==null?void 0:t.message)||"Gagal memuat paket soal",variant:"destructive"})}finally{W(!1)}}),ye=()=>y(this,null,function*(){try{const a=yield oe.subjects.getAll();L(a),a.length>0&&j(t=>v(g({},t),{subject_id:t.subject_id||a[0].id}))}catch(a){l({title:"Error",description:"Gagal memuat mata pelajaran",variant:"destructive"})}}),Se=()=>y(this,null,function*(){try{const t=((yield oe.teachers.getAll())||[]).map(s=>({id:s.id,name:s.name,email:s.email,subjects:Array.isArray(s.subjects)?s.subjects.map(n=>{var p,N;return{id:n.id,name:(N=(p=n.name)!=null?p:n.subject_name)!=null?N:""}}):[]}));h(t)}catch(a){l({title:"Error",description:"Gagal memuat data guru",variant:"destructive"})}}),H=a=>{var t,s;a?(R(a),j({name:a.name,description:a.description||"",subject_id:a.subject_id,difficulty_level:a.difficulty_level,teacher_id:a.created_by})):(R(null),j({name:"",description:"",subject_id:(s=(t=f[0])==null?void 0:t.id)!=null?s:0,difficulty_level:"medium",teacher_id:void 0})),Q(!0)},X=()=>{var a,t;Q(!1),R(null),j({name:"",description:"",subject_id:(t=(a=f[0])==null?void 0:a.id)!=null?t:0,difficulty_level:"medium",teacher_id:void 0})},ke=a=>y(this,null,function*(){var t,s;if(a.preventDefault(),!r.name.trim()){l({title:"Error",description:"Nama paket harus diisi",variant:"destructive"});return}if(!r.subject_id){l({title:"Error",description:"Mata pelajaran harus dipilih",variant:"destructive"});return}try{V?(yield I.update(V.id,r),l({title:"Berhasil",description:"Paket soal berhasil diperbarui"})):(yield I.create(r),l({title:"Berhasil",description:"Paket soal berhasil dibuat"})),X(),z()}catch(n){l({title:"Error",description:((s=(t=n.response)==null?void 0:t.data)==null?void 0:s.message)||"Gagal menyimpan paket soal",variant:"destructive"})}}),Y=a=>y(this,null,function*(){var t,s;try{yield I.duplicate(a.id),l({title:"Berhasil",description:"Paket soal berhasil diduplikasi"}),z()}catch(n){l({title:"Error",description:((s=(t=n.response)==null?void 0:t.data)==null?void 0:s.message)||"Gagal menduplikasi paket soal",variant:"destructive"})}}),Z=a=>y(this,null,function*(){var t,s;if(confirm(`Apakah Anda yakin ingin menghapus paket "${a.name}"?`))try{yield I.delete(a.id),l({title:"Berhasil",description:"Paket soal berhasil dihapus"}),z()}catch(n){l({title:"Error",description:((s=(t=n.response)==null?void 0:t.data)==null?void 0:s.message)||"Gagal menghapus paket soal",variant:"destructive"})}});return e.jsxs("div",{className:"p-2 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Paket Soal"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Kelola paket soal untuk memudahkan pembuatan ujian"})]}),e.jsxs(S,{onClick:()=>H(),children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Buat Paket Baru"]})]}),e.jsx(O,{children:e.jsx(K,{className:"pt-6",children:e.jsxs("div",{className:`grid grid-cols-1 ${m?"md:grid-cols-4":"md:grid-cols-3"} gap-4`,children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ke,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(te,{placeholder:"Cari paket soal...",value:q,onChange:a=>be(a.target.value),className:"pl-10"})]}),e.jsxs(_,{value:b,onValueChange:Ne,children:[e.jsx(P,{children:e.jsx(D,{placeholder:"Semua Mata Pelajaran"})}),e.jsxs(T,{children:[e.jsx(c,{value:"all",children:"Semua Mata Pelajaran"}),f.map(a=>e.jsx(c,{value:a.id.toString(),children:a.name},a.id))]})]}),e.jsxs(_,{value:G,onValueChange:ge,children:[e.jsx(P,{children:e.jsx(D,{placeholder:"Semua Tingkat"})}),e.jsxs(T,{children:[e.jsx(c,{value:"all",children:"Semua Tingkat"}),e.jsx(c,{value:"easy",children:"Mudah"}),e.jsx(c,{value:"medium",children:"Sedang"}),e.jsx(c,{value:"hard",children:"Sulit"})]})]}),m&&e.jsxs(_,{value:x,onValueChange:F,children:[e.jsx(P,{children:e.jsx(D,{placeholder:"Semua Guru"})}),e.jsxs(T,{children:[e.jsx(c,{value:"all",children:"Semua Guru"}),$.length===0?e.jsx(c,{value:"__none",disabled:!0,children:"Tidak ada guru untuk mapel ini"}):$.map(a=>e.jsx(c,{value:a.id.toString(),children:a.name},a.id))]})]})]})})}),B?e.jsx("div",{className:"flex justify-center py-16",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-t-4 border-blue-600 mx-auto"}),e.jsx("div",{className:"absolute inset-0 rounded-full h-16 w-16 border-4 border-blue-100 mx-auto"})]}),e.jsx("p",{className:"text-lg font-medium text-muted-foreground animate-pulse",children:"Memuat paket soal..."})]})}):E.length===0?e.jsx(O,{className:"border-0 shadow-sm",children:e.jsxs(K,{className:"text-center py-16",children:[e.jsx("div",{className:"inline-flex p-6 bg-muted rounded-full mb-4",children:e.jsx(U,{className:"w-16 h-16 text-muted-foreground"})}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Tidak ada paket soal ditemukan"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Belum ada paket soal yang tersedia saat ini"}),e.jsxs(S,{size:"lg",className:"gap-2 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700",onClick:()=>H(),children:[e.jsx(me,{className:"w-5 h-5"}),"Buat Paket Pertama"]})]})}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"border-0 shadow-md hidden md:block",children:e.jsx(K,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Ie,{children:[e.jsx(Ae,{children:e.jsxs(le,{className:"bg-muted/50 hover:bg-muted",children:[e.jsx(k,{className:"font-bold",children:"Nama Paket"}),e.jsx(k,{className:"font-bold",children:"Mata Pelajaran"}),e.jsx(k,{className:"font-bold",children:"Tingkat"}),e.jsx(k,{className:"font-bold text-center",children:"Total Soal"}),e.jsx(k,{className:"font-bold text-center",children:"Total Poin"}),e.jsx(k,{className:"font-bold",children:"Dibuat Oleh"}),e.jsx(k,{className:"font-bold text-right",children:"Aksi"})]})}),e.jsx(qe,{children:E.map((a,t)=>{var s,n,p,N;return e.jsxs(le,{className:`hover:bg-muted/30 transition-colors ${t%2===0?"":"bg-muted/10"}`,children:[e.jsx(w,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-500/10 dark:bg-purple-500/20 rounded-lg",children:e.jsx(U,{className:"w-4 h-4 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-semibold line-clamp-1",children:a.name}),a.description&&e.jsx("div",{className:"text-xs text-muted-foreground line-clamp-1",children:a.description})]})]})}),e.jsx(w,{children:e.jsx("span",{className:"text-sm font-medium text-blue-700 dark:text-blue-400",children:(s=a.subject)==null?void 0:s.name})}),e.jsx(w,{children:e.jsx(ce,{className:`${fe[a.difficulty_level]} border-0`,children:pe[a.difficulty_level]})}),e.jsx(w,{className:"text-center",children:e.jsx("span",{className:"font-semibold",children:((n=a.questions)==null?void 0:n.length)||0})}),e.jsx(w,{className:"text-center",children:e.jsx("span",{className:"font-semibold",children:((p=a.questions)==null?void 0:p.reduce((J,we)=>J+(we.points||0),0))||0})}),e.jsx(w,{children:e.jsx("span",{className:"text-sm text-muted-foreground",children:(N=a.creator)==null?void 0:N.name})}),e.jsx(w,{className:"text-right",children:e.jsxs(ie,{children:[e.jsx(re,{asChild:!0,children:e.jsx(S,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(ue,{className:"h-4 w-4"})})}),e.jsxs(ne,{align:"end",className:"w-48",children:[e.jsxs(C,{onClick:()=>o(`/question-packages/${a.id}`),children:[e.jsx(Le,{className:"w-4 h-4 mr-2"}),"Kelola Paket"]}),e.jsxs(C,{onClick:()=>H(a),children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Edit"]}),e.jsxs(C,{onClick:()=>Y(a),children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Duplikat"]}),e.jsx(de,{}),e.jsxs(C,{onClick:()=>Z(a),className:"text-red-600",children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Hapus"]})]})]})})]},a.id)})})]})})})}),e.jsx("div",{className:"space-y-3 md:hidden",children:E.map(a=>{var t,s,n,p;return e.jsx(O,{className:"border-0 shadow-sm hover:shadow-md transition-all",children:e.jsx(K,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-sm line-clamp-2",children:a.name}),a.description&&e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-1 mt-1",children:a.description})]}),e.jsx(ce,{className:`${fe[a.difficulty_level]} border-0 flex-shrink-0`,children:pe[a.difficulty_level]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-muted-foreground",children:"Mata Pelajaran"}),e.jsx("span",{className:"font-medium text-blue-700 dark:text-blue-400 truncate",children:(t=a.subject)==null?void 0:t.name})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-muted-foreground",children:"Dibuat Oleh"}),e.jsx("span",{className:"font-medium truncate",children:(s=a.creator)==null?void 0:s.name})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Soal"}),e.jsxs("span",{className:"font-semibold",children:[((n=a.questions)==null?void 0:n.length)||0," soal"]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Poin"}),e.jsxs("span",{className:"font-semibold",children:[((p=a.questions)==null?void 0:p.reduce((N,J)=>N+(J.points||0),0))||0," ","poin"]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2 border-t",children:[e.jsxs(S,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>o(`/question-packages/${a.id}`),children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Kelola"]}),e.jsxs(ie,{children:[e.jsx(re,{asChild:!0,children:e.jsx(S,{variant:"outline",size:"sm",children:e.jsx(ue,{className:"w-4 h-4"})})}),e.jsxs(ne,{align:"end",className:"w-48",children:[e.jsxs(C,{onClick:()=>H(a),children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Edit"]}),e.jsxs(C,{onClick:()=>Y(a),children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Duplikat"]}),e.jsx(de,{}),e.jsxs(C,{onClick:()=>Z(a),className:"text-red-600",children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Hapus"]})]})]})]})]})})},a.id)})})]}),e.jsx(Ge,{open:ve,onOpenChange:Q,children:e.jsxs(Fe,{children:[e.jsxs(Ve,{children:[e.jsx($e,{children:V?"Edit Paket Soal":"Buat Paket Soal Baru"}),e.jsx(ze,{children:"Isi informasi paket soal di bawah ini"})]}),e.jsxs("form",{onSubmit:ke,children:[e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"name",children:"Nama Paket *"}),e.jsx(te,{id:"name",placeholder:"Contoh: Paket Soal Matematika BAB 1",value:r.name,onChange:a=>j(v(g({},r),{name:a.target.value.toUpperCase()})),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"description",children:"Deskripsi"}),e.jsx(Oe,{id:"description",placeholder:"Deskripsi singkat tentang paket soal ini...",value:r.description,onChange:a=>j(v(g({},r),{description:a.target.value})),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"subject",children:"Mata Pelajaran *"}),e.jsxs(_,{value:r.subject_id?r.subject_id.toString():void 0,onValueChange:a=>j(v(g({},r),{subject_id:Number.parseInt(a,10)})),disabled:f.length===0,children:[e.jsx(P,{children:e.jsx(D,{placeholder:"Pilih mata pelajaran"})}),e.jsx(T,{children:f.map(a=>e.jsx(c,{value:a.id.toString(),children:a.name},a.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"difficulty",children:"Tingkat Kesulitan *"}),e.jsxs(_,{value:r.difficulty_level,onValueChange:a=>j(v(g({},r),{difficulty_level:a})),children:[e.jsx(P,{children:e.jsx(D,{})}),e.jsxs(T,{children:[e.jsx(c,{value:"easy",children:"Mudah"}),e.jsx(c,{value:"medium",children:"Sedang"}),e.jsx(c,{value:"hard",children:"Sulit"})]})]})]}),m&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"teacher",children:"Ditugaskan untuk Guru (Opsional)"}),e.jsxs(_,{value:((ee=r.teacher_id)==null?void 0:ee.toString())||"none",onValueChange:a=>j(v(g({},r),{teacher_id:a==="none"?void 0:Number.parseInt(a,10)})),children:[e.jsx(P,{children:e.jsx(D,{placeholder:"Pilih guru (opsional)"})}),e.jsxs(T,{children:[e.jsx(c,{value:"none",children:"Tidak ada (dibuat oleh admin)"}),u.filter(a=>r.subject_id?(a.subjects||[]).some(t=>t.id===r.subject_id):!0).map(a=>e.jsx(c,{value:a.id.toString(),children:a.name},a.id))]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Jika dipilih, paket soal akan ditampilkan sebagai dibuat oleh guru tersebut"})]})]}),e.jsxs(He,{children:[e.jsx(S,{type:"button",variant:"outline",onClick:X,children:"Batal"}),e.jsx(S,{type:"submit",children:V?"Simpan":"Buat Paket"})]})]})]})})]})}export{ba as default};
