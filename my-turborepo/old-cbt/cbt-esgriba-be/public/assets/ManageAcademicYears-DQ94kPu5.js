var U=Object.defineProperty,J=Object.defineProperties;var Q=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var A=(i,t,s)=>t in i?U(i,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[t]=s,k=(i,t)=>{for(var s in t||(t={}))V.call(t,s)&&A(i,s,t[s]);if(I)for(var s of I(t))W.call(t,s)&&A(i,s,t[s]);return i},_=(i,t)=>J(i,Q(t));var w=(i,t,s)=>new Promise((h,D)=>{var u=r=>{try{x(s.next(r))}catch(v){D(v)}},p=r=>{try{x(s.throw(r))}catch(v){D(v)}},x=r=>r.done?h(r.value):Promise.resolve(r.value).then(u,p);x((s=s.apply(i,t)).next())});import{j as a}from"./vendor-ui-XVksrZ5j.js";import{r as m}from"./vendor-react-DruPVAFJ.js";import{u as X,e as C,B as o,C as Z,a as aa,b as ea,c as sa,d as ta,L as S,I as y}from"./index-BmVdEGiP.js";import{D as Y,b as F,c as H,d as M,e as L,f as z}from"./dialog-FHcYl0q1.js";import{B as na}from"./badge-DVlZ2whw.js";import{P as ia}from"./plus-BcW2gs2h.js";import{C as la}from"./calendar-CL5fPy6R.js";import{C as G}from"./check-BFyP0Qeo.js";import{P as ra}from"./pen-square-DdkHHRrl.js";import{T as da}from"./trash-2-SALYx2gF.js";import"./vendor-utils-DI_-nBMo.js";import"./vendor-charts-BB9d_U7u.js";function Ca(){const[i,t]=m.useState([]),[s,h]=m.useState(!1),[D,u]=m.useState(!1),[p,x]=m.useState(null),[r,v]=m.useState(null),[b,j]=m.useState(!1),{toast:d}=X(),[c,N]=m.useState({name:"",start_date:"",end_date:""});m.useEffect(()=>{T()},[]);const T=()=>w(this,null,function*(){var e,l;try{const n=yield C.get("/academic-years");t(n.data.data)}catch(n){const f=((l=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:l.message)||(n==null?void 0:n.message)||"Gagal memuat data tahun pelajaran";d({title:"Error",description:f,variant:"destructive"})}}),E=e=>{e?(x(e),N({name:e.name,start_date:e.start_date,end_date:e.end_date})):(x(null),N({name:"",start_date:"",end_date:""})),h(!0)},$=()=>w(this,null,function*(){var e,l,n,f,B;j(!0);try{p?(yield C.put(`/academic-years/${p.id}`,c),d({title:"Berhasil",description:"Tahun pelajaran berhasil diperbarui"})):(yield C.post("/academic-years",c),d({title:"Berhasil",description:"Tahun pelajaran berhasil ditambahkan"})),h(!1),T()}catch(g){const O=(l=(e=g==null?void 0:g.response)==null?void 0:e.data)==null?void 0:l.errors,R=(O?(n=Object.values(O).flat())==null?void 0:n[0]:null)||((B=(f=g==null?void 0:g.response)==null?void 0:f.data)==null?void 0:B.message)||"Terjadi kesalahan";d({title:"Error",description:String(R),variant:"destructive"})}finally{j(!1)}}),q=e=>w(this,null,function*(){var l,n;j(!0);try{yield C.post(`/academic-years/${e}/set-active`),d({title:"Berhasil",description:"Tahun pelajaran aktif berhasil diubah"}),T()}catch(f){d({title:"Error",description:((n=(l=f.response)==null?void 0:l.data)==null?void 0:n.message)||"Gagal mengubah tahun aktif",variant:"destructive"})}finally{j(!1)}}),K=()=>w(this,null,function*(){var e,l;if(r){j(!0);try{yield C.delete(`/academic-years/${r}`),d({title:"Berhasil",description:"Tahun pelajaran berhasil dihapus"}),u(!1),T()}catch(n){d({title:"Error",description:((l=(e=n.response)==null?void 0:e.data)==null?void 0:l.message)||"Gagal menghapus tahun pelajaran",variant:"destructive"})}finally{j(!1)}}}),P=e=>new Date(e).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"});return a.jsxs("div",{className:"p-3 sm:p-6 pb-20",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-4 mb-4 sm:mb-6",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Kelola Tahun Pelajaran"}),a.jsx("p",{className:"text-muted-foreground mt-1 text-sm sm:text-base",children:"Manajemen tahun pelajaran dan periode akademik"})]}),a.jsxs(o,{className:"h-9 sm:h-10",onClick:()=>E(),children:[a.jsx(ia,{className:"mr-2 h-4 w-4"}),a.jsx("span",{className:"hidden sm:inline",children:"Tambah Tahun Pelajaran"}),a.jsx("span",{className:"sm:hidden",children:"Tambah"})]})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map(e=>a.jsxs(Z,{className:e.is_active?"border-primary":"",children:[a.jsxs(aa,{children:[a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsx(la,{className:"h-8 w-8 text-primary"}),e.is_active&&a.jsxs(na,{className:"bg-green-500",children:[a.jsx(G,{className:"mr-1 h-3 w-3"})," Aktif"]})]}),a.jsx(ea,{className:"mt-2",children:e.name}),a.jsxs(sa,{children:[P(e.start_date)," - ",P(e.end_date)]})]}),a.jsxs(ta,{children:[a.jsxs("div",{className:"flex items-center justify-between text-sm mb-4",children:[a.jsx("span",{className:"text-muted-foreground",children:"Total Ujian:"}),a.jsx("span",{className:"font-medium",children:e.tests_count||0})]}),a.jsxs("div",{className:"flex gap-2",children:[!e.is_active&&a.jsxs(o,{variant:"outline",size:"sm",onClick:()=>q(e.id),disabled:b,className:"flex-1",children:[a.jsx(G,{className:"mr-1 h-3 w-3"})," Aktifkan"]}),a.jsxs(o,{variant:"outline",size:"sm",onClick:()=>E(e),className:"flex-1",children:[a.jsx(ra,{className:"mr-1 h-3 w-3"})," Edit"]}),a.jsxs(o,{variant:"destructive",size:"sm",onClick:()=>{v(e.id),u(!0)},disabled:e.is_active,className:"flex-1",children:[a.jsx(da,{className:"mr-1 h-3 w-3"})," Hapus"]})]})]})]},e.id))}),a.jsx(Y,{open:s,onOpenChange:h,children:a.jsxs(F,{className:"w-[95vw] sm:max-w-[500px]",children:[a.jsxs(H,{children:[a.jsx(M,{children:p?"Edit Tahun Pelajaran":"Tambah Tahun Pelajaran"}),a.jsx(L,{children:p?"Perbarui informasi tahun pelajaran":"Tambahkan tahun pelajaran baru"})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx(S,{htmlFor:"name",children:"Tahun Pelajaran"}),a.jsx(y,{id:"name",value:c.name,onChange:e=>N(_(k({},c),{name:e.target.value})),placeholder:"Contoh: 2024/2025"})]}),a.jsxs("div",{children:[a.jsx(S,{htmlFor:"start_date",children:"Tanggal Mulai"}),a.jsx(y,{id:"start_date",type:"date",value:c.start_date,onChange:e=>N(_(k({},c),{start_date:e.target.value}))})]}),a.jsxs("div",{children:[a.jsx(S,{htmlFor:"end_date",children:"Tanggal Selesai"}),a.jsx(y,{id:"end_date",type:"date",value:c.end_date,onChange:e=>N(_(k({},c),{end_date:e.target.value}))})]})]}),a.jsxs(z,{className:"flex flex-col sm:flex-row gap-2",children:[a.jsx(o,{variant:"outline",onClick:()=>h(!1),className:"w-full sm:w-auto",children:"Batal"}),a.jsx(o,{onClick:$,disabled:b,className:"w-full sm:w-auto",children:b?"Menyimpan...":"Simpan"})]})]})}),a.jsx(Y,{open:D,onOpenChange:u,children:a.jsxs(F,{className:"w-[95vw] sm:max-w-[425px]",children:[a.jsxs(H,{children:[a.jsx(M,{children:"Hapus Tahun Pelajaran?"}),a.jsx(L,{children:"Data tahun pelajaran akan dihapus permanen. Tindakan ini tidak dapat dibatalkan."})]}),a.jsxs(z,{className:"flex flex-col sm:flex-row gap-2",children:[a.jsx(o,{variant:"outline",onClick:()=>u(!1),className:"w-full sm:w-auto",children:"Batal"}),a.jsx(o,{variant:"destructive",onClick:K,disabled:b,className:"w-full sm:w-auto",children:b?"Menghapus...":"Hapus"})]})]})})]})}export{Ca as default};
