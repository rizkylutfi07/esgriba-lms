var Qt=Object.defineProperty,At=Object.defineProperties;var Ft=Object.getOwnPropertyDescriptors;var Je=Object.getOwnPropertySymbols;var Bt=Object.prototype.hasOwnProperty,Ot=Object.prototype.propertyIsEnumerable;var Ye=(p,h,r)=>h in p?Qt(p,h,{enumerable:!0,configurable:!0,writable:!0,value:r}):p[h]=r,E=(p,h)=>{for(var r in h||(h={}))Bt.call(h,r)&&Ye(p,r,h[r]);if(Je)for(var r of Je(h))Ot.call(h,r)&&Ye(p,r,h[r]);return p},Q=(p,h)=>At(p,Ft(h));var f=(p,h,r)=>new Promise((j,J)=>{var Y=_=>{try{U(r.next(_))}catch(w){J(w)}},l=_=>{try{U(r.throw(_))}catch(w){J(w)}},U=_=>_.done?j(_.value):Promise.resolve(_.value).then(Y,l);U((r=r.apply(p,h)).next())});import{j as e}from"./vendor-ui-XVksrZ5j.js";import{h as $t,u as Gt,r as c}from"./vendor-react-DruPVAFJ.js";import{u as Mt,h as Lt,B as u,C as V,d as z,a as Vt,b as zt,I as le,L as A,e as Ut}from"./index-BmVdEGiP.js";import{B as K}from"./badge-DVlZ2whw.js";import{C as ne}from"./checkbox-DXq8pLEd.js";import{A as qt,b as Kt,a as Ht}from"./alert-BAo0Ym_t.js";import{M as I}from"./MathContent-BLSKFKlW.js";import{D as oe,b as de,c as ce,d as me,e as xe}from"./dialog-FHcYl0q1.js";import{S as We,a as Ze,b as Re,c as et,d as H}from"./select-CT0oUeJ5.js";import{r as Xt,u as Jt}from"./xlsx-Ccx-kdi7.js";import{q as X}from"./questionPackageService-DdsMbR7c.js";import{q as ue}from"./questionBankService-C-0gTY5G.js";import{m as Yt}from"./masterDataService-BT0EDdvP.js";import{A as Wt}from"./arrow-left-C1WfDAGK.js";import{T as tt}from"./trash-2-SALYx2gF.js";import{U as Zt}from"./upload-BUKVXWUj.js";import{P as st}from"./plus-BcW2gs2h.js";import{P as Rt}from"./pencil-DR_wvNsn.js";import{S as es}from"./search-NdQjMSfE.js";import{F as ts}from"./file-text-8Keq495L.js";import{C as ss}from"./check-circle-BdZ4TSjl.js";import{X as as}from"./x-circle-Czjy44Dj.js";import{A as is}from"./alert-triangle-Rfon99Uu.js";import"./vendor-utils-DI_-nBMo.js";import"./vendor-charts-BB9d_U7u.js";import"./check-BFyP0Qeo.js";import"./vendor-math-BWdfurLP.js";import"./chevron-down-CL3T_hsi.js";const at={mudah:1,sedang:2,sulit:3};function As(){var De,Qe,Ae,Fe,Be,Oe;const{id:p}=$t(),h=Gt(),{toast:r}=Mt(),{user:j}=Lt(),[J,Y]=c.useState(!0),[l,U]=c.useState(null),[_,w]=c.useState(!1),[it,rt]=c.useState([]),[y,W]=c.useState([]),[pe,ve]=c.useState(""),[lt,nt]=c.useState(!1),[G,Ne]=c.useState(null),[ot,dt]=c.useState([]),[he,ct]=c.useState(""),[F,Z]=c.useState([]),[ge,fe]=c.useState(!1),[je,be]=c.useState(!1),[M,R]=c.useState(null),[mt,ee]=c.useState(!1),[_e,we]=c.useState(!1),[b,te]=c.useState([]),[xt,se]=c.useState(!1),[ut,ae]=c.useState(!1),[Ce,ye]=c.useState(null),[o,C]=c.useState({question_text:"",question_type:"multiple_choice",category:"",difficulty_level:2,points:10,options:[{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1}],expected_answer:""}),[ke,Se]=c.useState(!1);c.useEffect(()=>{L(),pt()},[p]);const pt=()=>f(this,null,function*(){if((j==null?void 0:j.role)==="admin")try{const t=yield Yt.teachers.getAll();dt(t)}catch(t){console.error("Failed to load teachers:",t)}}),L=(t=!1,a=!1)=>f(this,null,function*(){var s;try{t||Y(!0);const i=yield X.getOne(parseInt(p),a);console.log("Package data loaded:",i),console.log("Questions count:",((s=i.questions)==null?void 0:s.length)||0),U(i)}catch(i){console.error("Error loading package:",i),r({title:"Error",description:"Gagal memuat detail paket",variant:"destructive"}),h("/question-packages")}finally{t||Y(!1)}}),Pe=()=>f(this,null,function*(){var t;if(l)try{const a=yield ue.getQuestions({subject_id:l.subject_id,per_page:100}),s=((t=l.questions)==null?void 0:t.map(x=>x.id))||[],i=a.data.filter(x=>!s.includes(x.id));rt(i)}catch(a){r({title:"Error",description:"Gagal memuat soal",variant:"destructive"})}}),ht=()=>f(this,null,function*(){if(y.length===0){r({title:"Error",description:"Pilih minimal 1 soal",variant:"destructive"});return}try{yield X.addQuestions(parseInt(p),y),yield L(!0),r({title:"Sukses",description:`${y.length} soal berhasil ditambahkan`}),w(!1),W([])}catch(t){r({title:"Error",description:"Gagal menambahkan soal",variant:"destructive"})}}),gt=t=>f(this,null,function*(){if(confirm("Yakin ingin menghapus soal ini dari paket?"))try{yield X.removeQuestion(parseInt(p),t),yield L(!0),r({title:"Sukses",description:"Soal berhasil dihapus dari paket"})}catch(a){r({title:"Error",description:"Gagal menghapus soal",variant:"destructive"})}}),ft=t=>{te(a=>a.includes(t)?a.filter(s=>s!==t):[...a,t])},jt=()=>{l!=null&&l.questions&&(b.length===l.questions.length?te([]):te(l.questions.map(t=>t.id)))},bt=()=>f(this,null,function*(){if(b.length!==0)try{for(const t of b)yield X.removeQuestion(parseInt(p),t);yield L(!0),r({title:"Sukses",description:`${b.length} soal berhasil dihapus dari paket`}),te([]),se(!1)}catch(t){r({title:"Error",description:"Gagal menghapus soal",variant:"destructive"})}}),Ee=t=>{W(a=>a.includes(t)?a.filter(s=>s!==t):[...a,t])},yt=t=>f(this,null,function*(){try{const a=yield ue.getQuestion(t.id);ye(a);const s=a.difficulty_level||2;if(a.question_type==="essay")C({question_text:a.question_text,question_type:"essay",category:a.category||"",difficulty_level:s,points:a.points||10,options:[{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1},{text:"",is_correct:!1}],expected_answer:a.expected_answer||""});else{const i=a.options||[],x=[...i.map(m=>({text:m.text||"",is_correct:m.is_correct||!1})),...Array(5-i.length).fill({text:"",is_correct:!1})].slice(0,5);C({question_text:a.question_text,question_type:"multiple_choice",category:a.category||"",difficulty_level:s,points:a.points||10,options:x,expected_answer:""})}ae(!0)}catch(a){r({title:"Error",description:"Gagal memuat data soal",variant:"destructive"})}}),kt=()=>f(this,null,function*(){var t,a;if(Ce){if(!o.question_text.trim()){r({title:"Error",description:"Teks soal tidak boleh kosong",variant:"destructive"});return}if(o.question_type==="multiple_choice"){const s=o.options.filter(x=>x.text.trim()!=="");if(s.length<2){r({title:"Error",description:"Minimal 2 pilihan jawaban harus diisi",variant:"destructive"});return}if(!s.some(x=>x.is_correct)){r({title:"Error",description:"Harus ada minimal 1 jawaban yang benar",variant:"destructive"});return}}else if(!o.expected_answer.trim()){r({title:"Error",description:"Kunci jawaban essay tidak boleh kosong",variant:"destructive"});return}Se(!0);try{const s={question_text:o.question_text,question_type:o.question_type,category:o.category,difficulty_level:o.difficulty_level,points:o.points};o.question_type==="multiple_choice"?s.options=o.options.filter(i=>i.text.trim()!=="").map(i=>({text:i.text,is_correct:i.is_correct})):s.expected_answer=o.expected_answer,yield ue.updateQuestion(Ce.id,s),yield L(!0,!0),r({title:"Sukses",description:"Soal berhasil diupdate"}),ae(!1),ye(null)}catch(s){r({title:"Error",description:((a=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:a.message)||"Gagal mengupdate soal",variant:"destructive"})}finally{Se(!1)}}}),vt=()=>{Ne(null),Z([]),R(null),ee(!1),fe(!1),be(!1)},ie=t=>{t||vt(),nt(t)},Nt=t=>{var s;const a=(s=t.target.files)==null?void 0:s[0];a&&(t.target.value="",Ne(a),Z([]),R(null),ee(!1))},k=t=>t==null?"":typeof t=="string"?t.trim():String(t).trim(),_t=(t,a)=>{var N,P,q,$e,Ge,Me,Le,Ve,ze,Ue,qe,Ke,He,Xe;const s=[],i=k((P=(N=t.Soal)!=null?N:t.Question)!=null?P:t.Pertanyaan),x=k((q=t["Pilihan A"])!=null?q:t["Option A"]),m=k(($e=t["Pilihan B"])!=null?$e:t["Option B"]),T=k((Ge=t["Pilihan C"])!=null?Ge:t["Option C"]),d=k((Me=t["Pilihan D"])!=null?Me:t["Option D"]),B=k((Le=t["Pilihan E"])!=null?Le:t["Option E"]),D=k((Ve=t.Kategori)!=null?Ve:t.Category),S=k((Ue=(ze=t["Tingkat Kesulitan"])!=null?ze:t.Kesulitan)!=null?Ue:t.Difficulty).toString().toLowerCase(),O=k((Ke=(qe=t.Poin)!=null?qe:t.Points)!=null?Ke:t.Point),v=k((Xe=(He=t["Jawaban Benar"])!=null?He:t.Jawaban)!=null?Xe:t.Answer).toString().toUpperCase();i||s.push("Soal tidak boleh kosong"),x||s.push("Pilihan A wajib diisi"),m||s.push("Pilihan B wajib diisi"),T||s.push("Pilihan C wajib diisi"),d||s.push("Pilihan D wajib diisi"),(!v||!["A","B","C","D","E"].includes(v))&&s.push("Jawaban Benar harus salah satu dari A-E"),v==="E"&&!B&&s.push("Pilihan E wajib diisi jika menjadi jawaban benar"),D||s.push("Kategori tidak boleh kosong"),(!S||!at[S])&&s.push("Tingkat kesulitan harus mudah, sedang, atau sulit");const n=Number(O),g=Number.isFinite(n)&&n>0;g||s.push("Poin harus berupa angka positif");const $=g?Math.round(n):1;return{question_text:i,option_a:x,option_b:m,option_c:T,option_d:d,option_e:B,correct_answer:v,category:D,difficulty:S,points:$,rowNumber:a,isValid:s.length===0,errors:s}},wt=t=>f(this,null,function*(){const a=yield t.arrayBuffer(),s=Xt(a,{type:"array"}),i=s.Sheets[s.SheetNames[0]],x=Jt.sheet_to_json(i);if(!x||x.length===0)throw new Error("Tidak ada data pada file.");return x.map((m,T)=>_t(m,T+2))}),Ct=t=>f(this,null,function*(){var a,s;try{const i=new FormData;i.append("file",t);const m=(yield Ut.post("/question-packages/parse-docx",i,{headers:{"Content-Type":"multipart/form-data"}})).data;if(!m.success)throw new Error(m.message||"Parsing failed");return console.log("=== SERVER PARSING COMPLETE ==="),console.log(`Total questions: ${m.data.total}`),console.log(`Valid: ${m.data.valid}, Invalid: ${m.data.invalid}`),m.debug&&(console.log("=== SERVER DEBUG INFO ==="),console.log("Element types found:",m.debug.unique_element_types),console.log("First 10 text segments:",m.debug.all_text.slice(0,10))),m.data.questions.length>0&&(console.log("=== IMAGE CHECK ==="),m.data.questions.forEach((d,B)=>{var O,v,n,g,$,N;const D=(O=d.question_text)==null?void 0:O.includes("<img"),S=((v=d.option_a)==null?void 0:v.includes("<img"))||((n=d.option_b)==null?void 0:n.includes("<img"))||((g=d.option_c)==null?void 0:g.includes("<img"))||(($=d.option_d)==null?void 0:$.includes("<img"));(D||S)&&console.log(`Question ${B+1}:`,{hasImageInQuestion:D,hasImageInOptions:S,questionPreview:(N=d.question_text)==null?void 0:N.substring(0,200)})})),m.data.questions.map(d=>({question_text:d.question_text,question_type:d.question_type,option_a:d.option_a,option_b:d.option_b,option_c:d.option_c,option_d:d.option_d,option_e:d.option_e,correct_answer:d.correct_answer,category:d.category||"Umum",difficulty:d.difficulty||"sedang",points:d.points,rowNumber:d.rowNumber,isValid:d.valid,errors:d.errors||[]}))}catch(i){throw console.error("Error parsing DOCX:",i),new Error(((s=(a=i.response)==null?void 0:a.data)==null?void 0:s.message)||i.message||"Failed to parse DOCX file")}}),St=()=>f(this,null,function*(){var t,a;if(G){fe(!0),Z([]),R(null),ee(!1);try{const s=(a=(t=G.name.split(".").pop())==null?void 0:t.toLowerCase())!=null?a:"";let i=[];if(s==="docx"){if(i=yield Ct(G),i.length===0)throw new Error("Tidak ditemukan soal pada file DOCX. Pastikan format mengikuti template [NOMOR].")}else if(s==="xlsx"||s==="xls")i=yield wt(G);else throw new Error("Format file tidak didukung. Gunakan file Excel (.xlsx/.xls) atau Word (.docx).");Z(i)}catch(s){console.error("Error parsing import file",s),r({title:"Gagal Membaca File",description:(s==null?void 0:s.message)||"Pastikan format file mengikuti template yang tersedia",variant:"destructive"})}finally{fe(!1)}}}),Pt=()=>f(this,null,function*(){var m,T,d,B,D,S,O,v;if(!l)return;if(!l.subject_id){r({title:"Paket Belum Lengkap",description:"Tentukan mata pelajaran untuk paket ini sebelum import",variant:"destructive"});return}const t=F.filter(n=>n.isValid);if(t.length===0){r({title:"Tidak Ada Soal Valid",description:"Perbaiki data soal yang bermasalah terlebih dahulu",variant:"destructive"});return}be(!0);const a=[];let s=0,i=0;const x=[];try{for(const n of t)try{const g=at[n.difficulty];if(!g)throw new Error("Tingkat kesulitan tidak valid");const $=n.question_type==="ESSAY",N={subject_id:l.subject_id,question_text:n.question_text,category:n.category,question_type:$?"essay":"multiple_choice",difficulty_level:g,points:n.points};(j==null?void 0:j.role)==="admin"&&he&&(N.teacher_id=parseInt(he)),$?N.expected_answer=n.correct_answer:N.options=[{text:n.option_a,is_correct:n.correct_answer==="A"},{text:n.option_b,is_correct:n.correct_answer==="B"},{text:n.option_c,is_correct:n.correct_answer==="C"},{text:n.option_d,is_correct:n.correct_answer==="D"},...n.option_e?[{text:n.option_e,is_correct:n.correct_answer==="E"}]:[]];const P=yield ue.createQuestion(N),q=(B=(m=P==null?void 0:P.question)==null?void 0:m.id)!=null?B:(d=(T=P==null?void 0:P.data)==null?void 0:T.question)==null?void 0:d.id;if(!q)throw new Error("ID soal baru tidak ditemukan dari response");a.push(q),s++}catch(g){i++,x.push(`Baris ${n.rowNumber}: ${((S=(D=g==null?void 0:g.response)==null?void 0:D.data)==null?void 0:S.message)||(g==null?void 0:g.message)||"Gagal menambahkan soal"}`)}if(a.length>0)try{yield X.addQuestions(l.id,a)}catch(n){i+=a.length,s=Math.max(0,s-a.length),x.push(((v=(O=n==null?void 0:n.response)==null?void 0:O.data)==null?void 0:v.message)||"Beberapa soal berhasil dibuat namun gagal ditambahkan ke paket")}R({success:s,failed:i,errors:x}),ee(!0),s>0&&i===0?setTimeout(()=>{ie(!1),r({title:"Import Berhasil!",description:`${s} soal berhasil ditambahkan ke paket`,duration:5e3})},1e3):r(E({title:"Proses Import Selesai",description:`${s} soal berhasil ditambahkan${i?`, ${i} soal gagal`:""}`},i?{variant:"destructive"}:{})),yield L(!0)}finally{be(!1)}}),Et=()=>f(this,null,function*(){we(!0);try{const t=yield fetch("/soal template/Template Soal CBT Esgriba.docx");if(!t.ok)throw new Error("Template file not found");const a=yield t.blob(),s=URL.createObjectURL(a),i=document.createElement("a");i.href=s,i.download="Template_Import_Paket_Soal.docx",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s)}catch(t){console.error("Failed to download DOCX template",t),r({title:"Gagal Mengunduh Template DOCX",description:(t==null?void 0:t.message)||"Pastikan file template tersedia di folder public.",variant:"destructive"})}finally{we(!1)}}),It=t=>{switch(t){case"easy":return"bg-green-100 text-green-700 border-green-200";case"medium":return"bg-yellow-100 text-yellow-700 border-yellow-200";case"hard":return"bg-red-100 text-red-700 border-red-200";default:return"bg-gray-100 text-gray-700 border-gray-200"}},Tt=t=>{switch(t){case"easy":return"Mudah";case"medium":return"Sedang";case"hard":return"Sulit";default:return"-"}},Ie=t=>{switch(t){case"multiple_choice":return"Pilihan Ganda";case"essay":return"Essay";default:return t}},Te=it.filter(t=>t.question_text.toLowerCase().includes(pe.toLowerCase())),re=F.filter(t=>t.isValid).length,Dt=F.length-re;return J?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:"Memuat detail paket..."})]})}):l?e.jsxs("div",{className:"space-y-4 md:space-y-6 p-2 md:p-0",children:[e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex items-start gap-2 md:gap-4",children:[e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>h("/question-packages"),className:"flex-shrink-0",children:[e.jsx(Wt,{className:"w-4 h-4 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"Kembali"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-xl md:text-3xl font-bold text-foreground line-clamp-2",children:l.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 flex-wrap",children:[e.jsx(K,{variant:"outline",className:"text-xs",children:(De=l.subject)==null?void 0:De.name}),e.jsx(K,{className:`${It(l.difficulty_level)} text-xs`,children:Tt(l.difficulty_level)})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[b.length>0&&e.jsxs(u,{variant:"destructive",size:"sm",onClick:()=>se(!0),className:"flex-1 md:flex-none",children:[e.jsx(tt,{className:"w-4 h-4 mr-1 md:mr-2"}),e.jsxs("span",{className:"text-xs md:text-sm",children:["Hapus (",b.length,")"]})]}),e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>ie(!0),className:"flex-1 md:flex-none",children:[e.jsx(Zt,{className:"w-4 h-4 mr-1 md:mr-2"}),e.jsx("span",{className:"text-xs md:text-sm",children:"Import"})]}),e.jsxs(u,{size:"sm",onClick:()=>{w(!0),Pe()},className:"flex-1 md:flex-none",children:[e.jsx(st,{className:"w-4 h-4 mr-1 md:mr-2"}),e.jsx("span",{className:"text-xs md:text-sm",children:"Tambah"})]})]})]}),l.description&&e.jsx(V,{children:e.jsx(z,{className:"pt-4 md:pt-6",children:e.jsx("p",{className:"text-sm md:text-base text-foreground",children:l.description})})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4",children:[e.jsx(V,{children:e.jsxs(z,{className:"pt-4 md:pt-6 text-center",children:[e.jsx("div",{className:"text-2xl md:text-3xl font-bold text-blue-600",children:((Qe=l.questions)==null?void 0:Qe.length)||0}),e.jsx("div",{className:"text-xs md:text-sm text-muted-foreground mt-1",children:"Total Soal"})]})}),e.jsx(V,{children:e.jsxs(z,{className:"pt-4 md:pt-6 text-center",children:[e.jsx("div",{className:"text-2xl md:text-3xl font-bold text-green-600",children:((Ae=l.questions)==null?void 0:Ae.reduce((t,a)=>t+(a.points||0),0))||0}),e.jsx("div",{className:"text-xs md:text-sm text-muted-foreground mt-1",children:"Total Poin"})]})}),e.jsx(V,{children:e.jsxs(z,{className:"pt-4 md:pt-6 text-center",children:[e.jsx("div",{className:"text-2xl md:text-3xl font-bold text-purple-600",children:((Fe=l.questions)==null?void 0:Fe.filter(t=>t.question_type==="multiple_choice").length)||0}),e.jsx("div",{className:"text-xs md:text-sm text-muted-foreground mt-1",children:"Pilihan Ganda"})]})}),e.jsx(V,{children:e.jsxs(z,{className:"pt-4 md:pt-6 text-center",children:[e.jsx("div",{className:"text-2xl md:text-3xl font-bold text-orange-600",children:((Be=l.questions)==null?void 0:Be.filter(t=>t.question_type==="essay").length)||0}),e.jsx("div",{className:"text-xs md:text-sm text-muted-foreground mt-1",children:"Essay"})]})})]}),e.jsxs(V,{children:[e.jsx(Vt,{children:e.jsxs(zt,{children:["Daftar Soal (",((Oe=l.questions)==null?void 0:Oe.length)||0,")"]})}),e.jsx(z,{className:"p-0",children:!l.questions||l.questions.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Belum ada soal dalam paket ini"}),e.jsxs(u,{onClick:()=>{w(!0),Pe()},children:[e.jsx(st,{className:"w-4 h-4 mr-2"}),"Tambah Soal Pertama"]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left w-12",children:e.jsx(ne,{checked:l.questions.length>0&&b.length===l.questions.length,onCheckedChange:jt})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-16",children:"No"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24",children:"Tipe"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pertanyaan"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-32",children:"Kategori"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-20",children:"Poin"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-24",children:"Aksi"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:l.questions.map((t,a)=>e.jsxs("tr",{className:`transition ${b.includes(t.id)?"bg-blue-50 dark:bg-blue-950":"hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx(ne,{checked:b.includes(t.id),onCheckedChange:()=>ft(t.id)})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100 font-medium",children:a+1}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t.question_type==="essay"?"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200"}`,children:Ie(t.question_type)})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"text-sm text-gray-900 dark:text-gray-100 max-w-md",children:e.jsx(I,{content:t.question_text.length>100?t.question_text.substring(0,100)+"...":t.question_text,className:"line-clamp-2"})})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:t.category||"-"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100 font-medium",children:t.points}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(u,{variant:"outline",size:"sm",onClick:()=>yt(t),title:"Edit soal",className:"hover:bg-blue-50 dark:hover:bg-blue-950",children:e.jsx(Rt,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"})}),e.jsx(u,{variant:"outline",size:"sm",onClick:()=>gt(t.id),title:"Hapus dari paket",className:"hover:bg-red-50 dark:hover:bg-red-950",children:e.jsx(tt,{className:"w-4 h-4 text-red-600 dark:text-red-400"})})]})})]},t.id))})]})})})]}),e.jsx(oe,{open:_,onOpenChange:w,children:e.jsxs(de,{className:"max-w-4xl max-h-[85vh] md:max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsxs(ce,{children:[e.jsx(me,{className:"text-lg md:text-xl",children:"Tambah Soal ke Paket"}),e.jsx(xe,{className:"text-sm",children:"Pilih soal dari bank soal untuk ditambahkan ke paket ini"})]}),e.jsxs("div",{className:"space-y-3 md:space-y-4 flex-1 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx(es,{className:"absolute left-3 top-2.5 md:top-3 h-4 w-4 text-muted-foreground"}),e.jsx(le,{placeholder:"Cari soal...",value:pe,onChange:t=>ve(t.target.value),className:"pl-10 text-sm md:text-base"})]}),y.length>0&&e.jsxs("div",{className:"flex items-center justify-between p-2.5 md:p-3 bg-blue-50 dark:bg-blue-950 rounded-lg flex-shrink-0",children:[e.jsxs("span",{className:"text-xs md:text-sm font-medium text-blue-700 dark:text-blue-300",children:[y.length," soal dipilih"]}),e.jsx(u,{variant:"link",size:"sm",onClick:()=>W([]),className:"text-blue-600 dark:text-blue-400 text-xs md:text-sm h-auto p-0",children:"Batal Pilih Semua"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto pr-2",children:Te.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:pe?"Tidak ada soal yang cocok":"Tidak ada soal tersedia"})}):e.jsx("div",{className:"space-y-2",children:Te.map(t=>e.jsx("div",{className:`p-3 md:p-4 border rounded-lg cursor-pointer transition-colors ${y.includes(t.id)?"border-blue-500 bg-blue-50 dark:bg-blue-950":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,onClick:()=>Ee(t.id),children:e.jsxs("div",{className:"flex items-start gap-2 md:gap-3",children:[e.jsx(ne,{checked:y.includes(t.id),onCheckedChange:()=>Ee(t.id),className:"mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 md:gap-2 mb-2 flex-wrap",children:[e.jsx(K,{variant:"outline",className:"text-xs",children:Ie(t.question_type)}),e.jsxs(K,{variant:"outline",className:"text-xs",children:[t.points,"p"]}),t.category&&e.jsx(K,{variant:"outline",className:"text-xs",children:t.category})]}),e.jsx(I,{content:t.question_text,className:"text-xs md:text-sm text-foreground line-clamp-2"})]})]})},t.id))})})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row justify-end gap-2 pt-3 md:pt-4 border-t flex-shrink-0",children:[e.jsx(u,{variant:"outline",size:"sm",onClick:()=>{w(!1),W([]),ve("")},className:"w-full sm:w-auto",children:"Batal"}),e.jsxs(u,{size:"sm",onClick:ht,disabled:y.length===0,className:"w-full sm:w-auto",children:["Tambah"," ",y.length>0&&`(${y.length})`," ","Soal"]})]})]})}),e.jsx(oe,{open:lt,onOpenChange:ie,children:e.jsxs(de,{className:"max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs(ce,{children:[e.jsx(me,{className:"text-lg md:text-xl",children:"Import Soal dari File"}),e.jsx(xe,{className:"text-sm",children:"Upload file DOCX menggunakan template yang disediakan untuk menambahkan soal langsung ke paket ini."})]}),e.jsxs("div",{className:"space-y-4 md:space-y-5 flex-1 overflow-y-auto pr-1",children:[e.jsxs("div",{className:"flex flex-col gap-2 md:gap-3 sm:flex-row sm:items-center sm:justify-between bg-gray-50 dark:bg-gray-900 rounded-lg p-3 md:p-4",children:[e.jsxs("div",{className:"text-xs md:text-sm text-foreground",children:[e.jsx("p",{className:"font-medium mb-1",children:"Download Template"}),e.jsx("p",{className:"text-muted-foreground text-xs md:text-sm",children:"File template sudah berisi contoh format yang benar"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsxs(u,{variant:"outline",size:"sm",onClick:Et,disabled:_e,className:"bg-white dark:bg-gray-800 text-xs md:text-sm",children:[e.jsx(ts,{className:"w-3.5 h-3.5 md:w-4 md:h-4 mr-1.5 md:mr-2"}),_e?"Menyiapkan...":"Template DOCX"]})})]}),(j==null?void 0:j.role)==="admin"&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950/30 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[e.jsx(A,{htmlFor:"teacher-select",className:"text-xs md:text-sm font-medium",children:"Ditugaskan untuk Guru (Opsional)"}),e.jsxs(We,{value:he||"none",onValueChange:t=>{ct(t==="none"?"":t)},children:[e.jsx(Ze,{id:"teacher-select",className:"mt-2",children:e.jsx(Re,{placeholder:"Pilih guru (opsional)"})}),e.jsxs(et,{children:[e.jsx(H,{value:"none",children:"Tidak ada (atas nama admin)"}),ot.filter(t=>{var a;return!(l!=null&&l.subject_id)||((a=t.subjects)==null?void 0:a.some(s=>s.id===l.subject_id))}).map(t=>e.jsx(H,{value:t.id.toString(),children:t.name},t.id))]})]}),e.jsx("p",{className:"mt-1.5 text-xs text-muted-foreground",children:"Soal akan ditampilkan atas nama guru yang dipilih"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs md:text-sm font-medium text-foreground mb-2",children:"File Import (.docx)"}),e.jsx("input",{type:"file",accept:".docx",onChange:Nt,className:`block w-full text-xs md:text-sm text-muted-foreground\r
                  file:mr-3 md:file:mr-4 file:py-1.5 md:file:py-2 file:px-3 md:file:px-4\r
                  file:rounded-md file:border-0\r
                  file:text-xs md:file:text-sm file:font-semibold\r
                  file:bg-blue-50 file:text-blue-700\r
                  hover:file:bg-blue-100`}),G&&e.jsxs("div",{className:"mt-2 md:mt-3 flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between text-xs md:text-sm text-muted-foreground",children:[e.jsxs("span",{className:"truncate",children:["File terpilih: ",G.name]}),e.jsx(u,{size:"sm",variant:"secondary",onClick:St,disabled:ge,className:"text-xs md:text-sm",children:ge?"Memproses...":"Parse File"})]})]}),F.length>0&&e.jsxs("div",{className:"space-y-2 md:space-y-3",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between text-xs md:text-sm",children:[e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:items-center sm:gap-3",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Total soal: ",F.length]}),e.jsxs("span",{className:"text-blue-600 dark:text-blue-400 font-medium",children:["Total Poin:"," ",F.filter(t=>t.isValid).reduce((t,a)=>t+a.points,0)]})]}),e.jsxs("div",{className:"flex items-center gap-3 md:gap-4",children:[e.jsxs("span",{className:"text-green-600 dark:text-green-400",children:["Valid: ",re]}),e.jsxs("span",{className:"text-red-600 dark:text-red-400",children:["Perlu Perbaikan: ",Dt]})]})]}),e.jsx("div",{className:"max-h-64 overflow-y-auto space-y-2 md:space-y-3 pr-1",children:F.map((t,a)=>e.jsxs("div",{className:`rounded-lg border p-3 md:p-4 transition-colors ${t.isValid?"border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-950":"border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-950"}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 md:gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 md:gap-2 text-xs md:text-sm font-medium text-foreground",children:[t.isValid?e.jsx(ss,{className:"h-4 w-4 text-green-600 dark:text-green-400"}):e.jsx(as,{className:"h-4 w-4 text-red-600 dark:text-red-400"}),e.jsxs("span",{children:["Soal ",t.rowNumber]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[t.category&&e.jsx("span",{className:"rounded bg-gray-200 dark:bg-gray-700 px-2 py-1 text-gray-700 dark:text-gray-200",children:t.category}),e.jsxs("span",{className:"rounded bg-blue-200 dark:bg-blue-900 px-2 py-1 text-blue-700 dark:text-blue-200",children:[t.points," poin"]}),e.jsx("span",{className:"rounded bg-blue-200 dark:bg-blue-900 px-2 py-1 text-blue-700 dark:text-blue-200",children:t.question_type})]})]}),e.jsx(I,{content:t.question_text,className:"mt-2 text-sm text-foreground"}),t.question_type==="ESSAY"?e.jsxs("div",{className:"mt-3 rounded-md bg-green-50 dark:bg-green-950",children:[e.jsx("div",{className:"mb-1 text-sm font-semibold text-green-800 dark:text-green-200",children:"Kunci Jawaban:"}),e.jsx(I,{content:t.correct_answer,className:"text-sm text-foreground"})]}):e.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-2 text-sm sm:grid-cols-2",children:[e.jsxs("div",{className:t.correct_answer==="A"?"font-semibold text-green-700 dark:text-green-400":"",children:[e.jsx("span",{children:"A. "}),e.jsx(I,{content:t.option_a,className:"inline"})]}),e.jsxs("div",{className:t.correct_answer==="B"?"font-semibold text-green-700 dark:text-green-400":"",children:[e.jsx("span",{children:"B. "}),e.jsx(I,{content:t.option_b,className:"inline"})]}),e.jsxs("div",{className:t.correct_answer==="C"?"font-semibold text-green-700 dark:text-green-400":"",children:[e.jsx("span",{children:"C. "}),e.jsx(I,{content:t.option_c,className:"inline"})]}),e.jsxs("div",{className:t.correct_answer==="D"?"font-semibold text-green-700 dark:text-green-400":"",children:[e.jsx("span",{children:"D. "}),e.jsx(I,{content:t.option_d,className:"inline"})]}),t.option_e&&e.jsxs("div",{className:t.correct_answer==="E"?"font-semibold text-green-700 dark:text-green-400":"",children:[e.jsx("span",{children:"E. "}),e.jsx(I,{content:t.option_e,className:"inline"})]})]}),!t.isValid&&t.errors.length>0&&e.jsx("div",{className:"mt-3 rounded-md border border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-950 p-3",children:e.jsxs("div",{className:"flex gap-2 text-sm text-red-700 dark:text-red-300",children:[e.jsx(is,{className:"mt-0.5 h-4 w-4 flex-shrink-0"}),e.jsx("div",{className:"space-y-1",children:t.errors.map((s,i)=>e.jsxs("p",{children:["• ",s]},i))})]})})]},`${t.rowNumber}-${a}`))})]}),mt&&M&&e.jsxs(qt,{variant:M.failed?"destructive":"default",children:[e.jsx(Kt,{children:"Hasil Import"}),e.jsx(Ht,{children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{className:"font-medium text-green-600 dark:text-green-400",children:["Berhasil: ",M.success," soal"]}),M.failed>0&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"font-medium text-red-600 dark:text-red-400",children:["Gagal: ",M.failed," soal"]}),e.jsx("div",{className:"max-h-32 space-y-1 overflow-y-auto text-red-600 dark:text-red-400",children:M.errors.map((t,a)=>e.jsxs("p",{children:["• ",t]},a))})]})]})})]})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row justify-end gap-2 border-t pt-3 md:pt-4",children:[e.jsx(u,{variant:"outline",size:"sm",onClick:()=>ie(!1),disabled:je,className:"w-full sm:w-auto",children:"Tutup"}),e.jsx(u,{size:"sm",onClick:Pt,disabled:je||re===0||ge,className:"w-full sm:w-auto",children:je?"Mengimport...":`Import ${re} Soal`})]})]})}),e.jsx(oe,{open:ut,onOpenChange:ae,children:e.jsxs(de,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ce,{children:[e.jsx(me,{children:"Edit Soal"}),e.jsx(xe,{children:"Ubah detail soal di bawah ini"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"edit-question-text",children:"Teks Soal *"}),e.jsx("textarea",{id:"edit-question-text",className:"w-full min-h-[100px] px-3 py-2 border rounded-md",value:o.question_text,onChange:t=>C(Q(E({},o),{question_text:t.target.value})),placeholder:"Masukkan teks soal..."})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"edit-category",children:"Kategori"}),e.jsx(le,{id:"edit-category",value:o.category,onChange:t=>C(Q(E({},o),{category:t.target.value})),placeholder:"Misal: Aljabar, Geometri, dll"})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"edit-difficulty",children:"Tingkat Kesulitan *"}),e.jsxs(We,{value:o.difficulty_level.toString(),onValueChange:t=>C(Q(E({},o),{difficulty_level:parseInt(t)})),children:[e.jsx(Ze,{id:"edit-difficulty",children:e.jsx(Re,{})}),e.jsxs(et,{children:[e.jsx(H,{value:"1",children:"Mudah"}),e.jsx(H,{value:"2",children:"Sedang"}),e.jsx(H,{value:"3",children:"Sulit"})]})]})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"edit-points",children:"Poin *"}),e.jsx(le,{id:"edit-points",type:"number",min:"1",value:o.points,onChange:t=>C(Q(E({},o),{points:parseInt(t.target.value)||10}))})]}),o.question_type==="multiple_choice"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(A,{children:"Pilihan Jawaban *"}),o.options.map((t,a)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ne,{checked:t.is_correct,onCheckedChange:s=>{const i=[...o.options];i[a].is_correct=s,C(Q(E({},o),{options:i}))},className:"mt-3"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs(A,{className:"text-xs text-muted-foreground",children:["Pilihan ",String.fromCharCode(65+a)]}),e.jsx(le,{value:t.text,onChange:s=>{const i=[...o.options];i[a].text=s.target.value,C(Q(E({},o),{options:i}))},placeholder:`Pilihan ${String.fromCharCode(65+a)}`})]})]},a)),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Centang kotak untuk menandai jawaban yang benar"})]}),o.question_type==="essay"&&e.jsxs("div",{children:[e.jsx(A,{htmlFor:"edit-expected-answer",children:"Kunci Jawaban *"}),e.jsx("textarea",{id:"edit-expected-answer",className:"w-full min-h-[80px] px-3 py-2 border rounded-md",value:o.expected_answer,onChange:t=>C(Q(E({},o),{expected_answer:t.target.value})),placeholder:"Masukkan kunci jawaban essay..."})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(u,{variant:"outline",onClick:()=>{ae(!1),ye(null)},disabled:ke,children:"Batal"}),e.jsx(u,{onClick:kt,disabled:ke,children:ke?"Menyimpan...":"Simpan Perubahan"})]})]})}),e.jsx(oe,{open:xt,onOpenChange:se,children:e.jsxs(de,{children:[e.jsxs(ce,{children:[e.jsxs(me,{children:["Hapus ",b.length," Soal?"]}),e.jsxs(xe,{children:["Tindakan ini akan menghapus ",b.length," soal dari paket ini. Soal tidak akan dihapus dari bank soal, hanya dihapus dari paket ini."]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(u,{variant:"outline",onClick:()=>se(!1),children:"Batal"}),e.jsx(u,{variant:"destructive",onClick:bt,children:"Hapus Semua"})]})]})})]}):null}export{As as default};
