var oe=Object.defineProperty,de=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var me=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable;var W=(c,o,r)=>o in c?oe(c,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):c[o]=r,k=(c,o)=>{for(var r in o||(o={}))me.call(o,r)&&W(c,r,o[r]);if(Q)for(var r of Q(o))pe.call(o,r)&&W(c,r,o[r]);return c},S=(c,o)=>de(c,ce(o));var N=(c,o,r)=>new Promise((h,I)=>{var v=j=>{try{u(r.next(j))}catch(g){I(g)}},A=j=>{try{u(r.throw(j))}catch(g){I(g)}},u=j=>j.done?h(j.value):Promise.resolve(j.value).then(v,A);u((r=r.apply(c,o)).next())});import{j as e}from"./vendor-ui-XVksrZ5j.js";import{r as m}from"./vendor-react-DruPVAFJ.js";import{B as p,u as xe,e as w,L as O,I as K}from"./index-BmVdEGiP.js";import{D as U,b as G,c as L,d as R,e as V,f as X}from"./dialog-FHcYl0q1.js";import{S as he,a as je,b as ue,c as ge,d as Y}from"./select-CT0oUeJ5.js";import{A as Z,D as be}from"./data-table-qMSffp-C.js";import{D as fe,a as Ne,b as we,d as ve,e as ye,c as ee}from"./dropdown-menu-BDf3JuuU.js";import{B as ke}from"./badge-DVlZ2whw.js";import{M as Se}from"./more-horizontal-B_tWyvgt.js";import{P as De}from"./pencil-DR_wvNsn.js";import{T as _e}from"./trash-2-SALYx2gF.js";import{U as H}from"./upload-BUKVXWUj.js";import{D as Ce}from"./download-Cc0AJeaF.js";import{P as Me}from"./plus-BcW2gs2h.js";import{F as Ie}from"./file-spreadsheet-BhItZ3XK.js";import"./vendor-utils-DI_-nBMo.js";import"./vendor-charts-BB9d_U7u.js";import"./chevron-down-CL3T_hsi.js";import"./check-BFyP0Qeo.js";import"./vendor-table-DRaoTYIa.js";import"./table-BTQg55BV.js";import"./chevron-left-Cico8d1J.js";import"./chevron-right-DGvanUYx.js";import"./circle-B_uur8fk.js";const Ee=(c,o)=>[{accessorKey:"subject_name",header:({column:r})=>e.jsxs(p,{variant:"ghost",onClick:()=>r.toggleSorting(r.getIsSorted()==="asc"),className:"hover:bg-slate-100 dark:hover:bg-slate-800 text-xs sm:text-sm p-1 sm:p-4 h-auto",children:["Nama Mata Pelajaran",e.jsx(Z,{className:"ml-1 sm:ml-2 h-3 w-3 sm:h-4 sm:w-4"})]}),cell:({row:r})=>e.jsxs("div",{className:"font-medium text-slate-900 dark:text-white text-xs sm:text-sm min-w-[110px] max-w-[200px] sm:max-w-none",children:[e.jsx("div",{className:"truncate",children:r.getValue("subject_name")}),e.jsx("div",{className:"text-[10px] sm:hidden text-slate-500 dark:text-slate-400 truncate mt-0.5",children:r.original.subject_code})]})},{accessorKey:"subject_code",header:({column:r})=>e.jsx("div",{className:"hidden sm:block",children:e.jsxs(p,{variant:"ghost",onClick:()=>r.toggleSorting(r.getIsSorted()==="asc"),className:"hover:bg-slate-100 dark:hover:bg-slate-800",children:["Kode",e.jsx(Z,{className:"ml-2 h-4 w-4"})]})}),cell:({row:r})=>e.jsx(ke,{variant:"outline",className:"font-mono dark:border-slate-600 dark:text-slate-300 hidden sm:inline-flex",children:r.getValue("subject_code")})},{accessorKey:"major.major_name",header:()=>e.jsx("div",{className:"text-xs sm:text-sm hidden md:table-cell",children:"Jurusan"}),cell:({row:r})=>{const h=r.original.major;return e.jsx("span",{className:"text-slate-600 dark:text-slate-400 hidden md:inline",children:h?h.major_name||h.name:"Umum"})}},{accessorKey:"description",header:()=>e.jsx("div",{className:"text-xs sm:text-sm hidden lg:table-cell",children:"Deskripsi"}),cell:({row:r})=>e.jsx("div",{className:"max-w-[300px] truncate text-slate-600 dark:text-slate-400 hidden lg:block",children:r.getValue("description")||"-"})},{id:"actions",header:()=>e.jsx("div",{className:"text-xs sm:text-sm text-center",children:"Aksi"}),cell:({row:r})=>{const h=r.original;return e.jsx("div",{className:"flex justify-center",children:e.jsxs(fe,{children:[e.jsx(Ne,{asChild:!0,children:e.jsxs(p,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-slate-100 dark:hover:bg-slate-800",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(Se,{className:"h-4 w-4"})]})}),e.jsxs(we,{align:"end",className:"bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-700 w-36",children:[e.jsx(ve,{className:"dark:text-white text-xs",children:"Aksi"}),e.jsx(ye,{className:"bg-slate-200 dark:bg-slate-700"}),e.jsxs(ee,{onClick:()=>c(h),className:"cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-800 dark:text-slate-200 text-xs",children:[e.jsx(De,{className:"mr-2 h-3 w-3"}),"Edit"]}),e.jsxs(ee,{onClick:()=>o(h),className:"cursor-pointer text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/30 text-xs",children:[e.jsx(_e,{className:"mr-2 h-3 w-3"}),"Hapus"]})]})]})})}}];function ta(){const[c,o]=m.useState([]),[r,h]=m.useState([]),[I,v]=m.useState(!1),[A,u]=m.useState(!1),[j,g]=m.useState(!1),[D,$]=m.useState(null),[y,z]=m.useState(!1),[n,_]=m.useState(null),[E,T]=m.useState(null),[J,ae]=m.useState(null),[B,P]=m.useState(!1),{toast:d}=xe(),[x,b]=m.useState({major_id:"",code:"",name:""});m.useEffect(()=>{F(),se()},[]);const F=()=>N(this,null,function*(){try{const l=(yield w.get("/subjects")).data.data.map(s=>S(k({},s),{subject_name:s.subject_name||s.name,subject_code:s.subject_code||s.code,major:s.major?S(k({},s.major),{major_name:s.major.major_name||s.major.name}):void 0}));o(l)}catch(a){d({title:"Error",description:"Gagal memuat data mata pelajaran",variant:"destructive"})}}),se=()=>N(this,null,function*(){try{const a=yield w.get("/majors");h(a.data.data)}catch(a){d({title:"Error",description:"Gagal memuat data jurusan",variant:"destructive"})}}),q=a=>{var l;a?(T(a),b({major_id:((l=a.major_id)==null?void 0:l.toString())||"",code:a.subject_code,name:a.subject_name})):(T(null),b({major_id:"",code:"",name:""})),v(!0)},te=()=>N(this,null,function*(){var a,l;if(!x.code.trim()){d({title:"Error",description:"Kode mata pelajaran harus diisi",variant:"destructive"});return}if(!x.name.trim()){d({title:"Error",description:"Nama mata pelajaran harus diisi",variant:"destructive"});return}P(!0);try{const s={code:x.code.trim(),name:x.name.trim(),major_id:x.major_id?parseInt(x.major_id):null};E?(yield w.put(`/subjects/${E.id}`,s),d({title:"Berhasil",description:"Mata pelajaran berhasil diperbarui"})):(yield w.post("/subjects",s),d({title:"Berhasil",description:"Mata pelajaran berhasil ditambahkan"})),v(!1),b({major_id:"",code:"",name:""}),F()}catch(s){d({title:"Error",description:((l=(a=s.response)==null?void 0:a.data)==null?void 0:l.message)||"Terjadi kesalahan",variant:"destructive"})}finally{P(!1)}}),re=()=>N(this,null,function*(){var a,l;if(J){P(!0);try{yield w.delete(`/subjects/${J}`),d({title:"Berhasil",description:"Mata pelajaran berhasil dihapus"}),u(!1),F()}catch(s){d({title:"Error",description:((l=(a=s.response)==null?void 0:a.data)==null?void 0:l.message)||"Gagal menghapus mata pelajaran",variant:"destructive"})}finally{P(!1)}}}),le=()=>N(this,null,function*(){var a,l;try{const s=yield w.get("/subjects/template",{responseType:"blob"}),t=window.URL.createObjectURL(new Blob([s.data])),i=document.createElement("a");i.href=t,i.setAttribute("download","template_import_mapel.xlsx"),document.body.appendChild(i),i.click(),i.remove(),d({title:"Berhasil",description:"Template berhasil didownload"})}catch(s){d({title:"Error",description:((l=(a=s.response)==null?void 0:a.data)==null?void 0:l.message)||"Gagal download template",variant:"destructive"})}}),ie=()=>N(this,null,function*(){var a,l;if(!D){d({title:"Error",description:"Silakan pilih file Excel terlebih dahulu",variant:"destructive"});return}z(!0),_(null);try{const s=new FormData;s.append("file",D);const t=yield w.post("/subjects/import",s,{headers:{"Content-Type":"multipart/form-data"}});_(t.data),d({title:"Import Berhasil",description:`${t.data.stats.success} mata pelajaran berhasil diimport${t.data.stats.failed>0?`, ${t.data.stats.failed} gagal`:""}`}),F(),t.data.stats.failed===0&&setTimeout(()=>{g(!1),$(null),_(null)},3e3)}catch(s){const t=(a=s.response)==null?void 0:a.data;let i=[];t!=null&&t.errors&&(Array.isArray(t.errors)?i=t.errors:typeof t.errors=="object"&&(i=Object.entries(t.errors).map(([M,f])=>({field:M,message:Array.isArray(f)?f.join(", "):typeof f=="string"?f:String(f)})))),_({message:(t==null?void 0:t.message)||"Import gagal",errors:i,stats:(t==null?void 0:t.stats)||null});let C=(t==null?void 0:t.message)||s.message||"Gagal mengimport data";((l=s.response)==null?void 0:l.status)===422&&i.length>0&&(C=`Validasi gagal: ${i.slice(0,3).map(M=>{var f;return M.message||((f=M.errors)==null?void 0:f[0])||String(M)}).join("; ")}`,i.length>3&&(C+=` dan ${i.length-3} error lainnya`)),d({title:"Error Import",description:C,variant:"destructive"})}finally{z(!1)}}),ne=()=>N(this,null,function*(){var a,l;try{const s=yield w.get("/subjects/export",{responseType:"blob"}),t=window.URL.createObjectURL(new Blob([s.data])),i=document.createElement("a");i.href=t;const C=`data_mapel_${new Date().toISOString().split("T")[0]}.xlsx`;i.setAttribute("download",C),document.body.appendChild(i),i.click(),i.remove(),d({title:"Berhasil",description:"Data mata pelajaran berhasil diexport"})}catch(s){d({title:"Error",description:((l=(a=s.response)==null?void 0:a.data)==null?void 0:l.message)||"Gagal export data",variant:"destructive"})}});return e.jsxs("div",{className:"p-3 sm:p-6 pb-20",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-4 mb-4 sm:mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-900 dark:text-white",children:"Kelola Mata Pelajaran"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mt-1 text-sm sm:text-base",children:"Manajemen data mata pelajaran dan kurikulum"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>g(!0),className:"dark:border-slate-700 dark:hover:bg-slate-800 h-9 px-3",children:[e.jsx(H,{className:"mr-2 h-4 w-4"})," ",e.jsx("span",{className:"hidden sm:inline",children:"Import"}),e.jsx("span",{className:"sm:hidden",children:"Import"})]}),e.jsxs(p,{variant:"outline",size:"sm",onClick:ne,className:"dark:border-slate-700 dark:hover:bg-slate-800 h-9 px-3",children:[e.jsx(Ce,{className:"mr-2 h-4 w-4"})," ",e.jsx("span",{className:"hidden sm:inline",children:"Export"}),e.jsx("span",{className:"sm:hidden",children:"Export"})]}),e.jsxs(p,{className:"h-9 sm:h-10",onClick:()=>q(),children:[e.jsx(Me,{className:"mr-2 h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Tambah Mata Pelajaran"}),e.jsx("span",{className:"sm:hidden",children:"Tambah"})]})]})]}),e.jsx(be,{columns:Ee(a=>q(a),a=>{ae(a.id),u(!0)}),data:c,searchKey:"subject_name",searchPlaceholder:"Cari mata pelajaran..."}),e.jsx(U,{open:I,onOpenChange:a=>{v(a),a||(T(null),b({major_id:"",code:"",name:""}))},children:e.jsxs(G,{className:"w-[95vw] sm:max-w-[500px]",children:[e.jsxs(L,{children:[e.jsx(R,{children:E?"Edit Mata Pelajaran":"Tambah Mata Pelajaran"}),e.jsx(V,{children:E?"Perbarui informasi mata pelajaran":"Tambahkan mata pelajaran baru ke sistem"})]}),e.jsxs("div",{className:"grid gap-3 py-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(O,{htmlFor:"code",children:"Kode Mata Pelajaran"}),e.jsx(K,{id:"code",value:x.code,onChange:a=>b(S(k({},x),{code:a.target.value})),placeholder:"Contoh: MTK"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(O,{htmlFor:"name",children:"Nama Mata Pelajaran"}),e.jsx(K,{id:"name",value:x.name,onChange:a=>b(S(k({},x),{name:a.target.value})),placeholder:"Contoh: Matematika"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(O,{htmlFor:"major_id",children:"Jurusan (Opsional)"}),e.jsxs(he,{value:x.major_id||"0",onValueChange:a=>b(S(k({},x),{major_id:a==="0"?"":a})),children:[e.jsx(je,{id:"major_id",children:e.jsx(ue,{placeholder:"Pilih jurusan"})}),e.jsxs(ge,{children:[e.jsx(Y,{value:"0",children:"Umum (Semua Jurusan)"}),r.map(a=>e.jsx(Y,{value:a.id.toString(),children:a.name},a.id))]})]})]})]}),e.jsxs(X,{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>{v(!1),T(null),b({major_id:"",code:"",name:""})},className:"w-full sm:w-auto",children:"Batal"}),e.jsx(p,{type:"submit",onClick:te,disabled:B,className:"w-full sm:w-auto",children:B?"Menyimpan...":"Simpan"})]})]})}),e.jsx(U,{open:A,onOpenChange:u,children:e.jsxs(G,{className:"w-[95vw] sm:max-w-[425px]",children:[e.jsxs(L,{children:[e.jsx(R,{children:"Hapus Mata Pelajaran?"}),e.jsx(V,{children:"Data mata pelajaran akan dihapus permanen. Tindakan ini tidak dapat dibatalkan."})]}),e.jsxs(X,{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>u(!1),className:"w-full sm:w-auto",children:"Batal"}),e.jsx(p,{type:"button",variant:"destructive",onClick:re,disabled:B,className:"w-full sm:w-auto",children:B?"Menghapus...":"Hapus"})]})]})}),e.jsx(U,{open:j,onOpenChange:g,children:e.jsxs(G,{className:"w-[95vw] sm:max-w-[600px]",children:[e.jsxs(L,{children:[e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5 text-green-600"}),"Import Data Mata Pelajaran dari Excel"]}),e.jsx(V,{children:"Upload file Excel (.xlsx atau .xls) untuk import data mata pelajaran secara massal"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"import-file",children:"Pilih File Excel"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{id:"import-file",type:"file",accept:".xlsx,.xls",onChange:a=>{var l;return $(((l=a.target.files)==null?void 0:l[0])||null)},disabled:y,className:"flex-1"}),e.jsxs(p,{variant:"outline",onClick:le,disabled:y,className:"whitespace-nowrap",children:[e.jsx(Ie,{className:"mr-2 h-4 w-4"}),"Template"]})]}),D&&e.jsxs("p",{className:"text-sm text-green-600",children:["âœ“ File dipilih: ",D.name]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 space-y-2",children:[e.jsx("h4",{className:"font-semibold text-blue-900 text-sm",children:"ðŸ“‹ Format Data Excel:"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1 ml-4 list-disc",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"nama"})," - Nama mata pelajaran (wajib)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"kode"})," - Kode mapel uppercase (wajib, unique). Contoh: MAT, BIND"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"deskripsi"})," - Keterangan mata pelajaran (opsional)"]})]})]}),n&&e.jsxs("div",{className:`rounded-lg p-4 space-y-2 ${n.stats?n.stats.failed>0?"bg-yellow-50 border border-yellow-200":"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:[e.jsx("h4",{className:`font-semibold text-sm ${n.stats?n.stats.failed>0?"text-yellow-900":"text-green-900":"text-red-900"}`,children:n.stats?n.stats.failed>0?"âš ï¸ Import Selesai dengan Beberapa Error":"âœ… Import Berhasil!":"âŒ Import Gagal"}),!n.stats&&n.message&&e.jsx("p",{className:"text-sm text-red-700",children:n.message}),n.stats&&e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{className:"text-green-700",children:["âœ“ Berhasil: ",n.stats.success," mata pelajaran"]}),n.stats.failed>0&&e.jsxs("p",{className:"text-red-700",children:["âœ— Gagal: ",n.stats.failed," mata pelajaran"]})]}),n.errors&&n.errors.length>0&&e.jsxs("div",{className:"mt-3 max-h-40 overflow-y-auto",children:[e.jsx("p",{className:"text-sm font-semibold text-red-800 mb-2",children:"Detail Error:"}),e.jsxs("div",{className:"space-y-2",children:[n.errors.slice(0,5).map((a,l)=>{var i;let s="",t="";return typeof a=="string"?t=a:a.row?(s=`Baris ${a.row}`,t=((i=a.errors)==null?void 0:i.join(", "))||a.error||a.message||String(a),a.attribute&&(t=`${a.attribute}: ${t}`)):a.field?(s=a.field,t=a.message||String(a)):a.error||a.errors?t=a.error||(Array.isArray(a.errors)?a.errors.join(", "):String(a.errors)):t=String(a),e.jsxs("div",{className:"text-xs bg-white p-2 rounded border border-red-200",children:[s&&e.jsx("p",{className:"font-semibold text-red-700",children:s}),e.jsx("p",{className:"text-red-600",children:t})]},l)}),n.errors.length>5&&e.jsxs("p",{className:"text-xs text-gray-600 italic",children:["...dan ",n.errors.length-5," error lainnya"]})]})]})]}),y&&e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"}),e.jsx("span",{className:"ml-3 text-sm text-gray-600",children:"Mengimport data..."})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-2",children:[e.jsx(p,{variant:"outline",onClick:()=>{g(!1),$(null),_(null)},disabled:y,className:"w-full sm:w-auto",children:n?"Tutup":"Batal"}),e.jsx(p,{className:"bg-green-600 hover:bg-green-700 text-white",onClick:ie,disabled:!D||y,children:y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),"Import Sekarang"]})})]})]})})]})}export{ta as default};
