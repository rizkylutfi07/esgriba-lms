var y=(o,_,v)=>new Promise((S,C)=>{var i=g=>{try{r(v.next(g))}catch(f){C(f)}},L=g=>{try{r(v.throw(g))}catch(f){C(f)}},r=g=>g.done?S(g.value):Promise.resolve(g.value).then(i,L);r((v=v.apply(o,_)).next())});import{j as e}from"./vendor-ui-XVksrZ5j.js";import{r as n}from"./vendor-react-DruPVAFJ.js";import{f as N,u as Ke,B as k,C as B,a as q,b as J,c as _e,L as qe,i as M,d as X,I as Je}from"./index-BmVdEGiP.js";import{B as p}from"./badge-DVlZ2whw.js";import{S as Q,a as W,b as Y,c as Z,d as D}from"./select-CT0oUeJ5.js";import{S as Xe}from"./switch-DIYy5p1r.js";import{A as Se,a as Ce,b as Ae,c as Be,d as Me,e as De,f as Te,g as Le}from"./alert-dialog-DeGwCm2P.js";import{T as Qe}from"./textarea-Bx_nRJgZ.js";import{t as T}from"./testService-BhFWneWt.js";import{b as O,f as We}from"./vendor-utils-DI_-nBMo.js";import{L as b,C as ee}from"./loader-2-DyIj99pk.js";import{U as se}from"./users-Cv97A8df.js";import{C as ae}from"./clock-eO0sA20s.js";import{A as Ue}from"./alert-circle-Cjt8dlsE.js";import{i as Ye}from"./id-mgxg9YzS.js";import"./vendor-charts-BB9d_U7u.js";import"./chevron-down-CL3T_hsi.js";import"./check-BFyP0Qeo.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=N("ArrowDownUp",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"m21 8-4-4-4 4",key:"1c9v7m"}],["path",{d:"M17 4v16",key:"7dpous"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=N("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=N("FilterX",[["path",{d:"M13.013 3H2l8 9.46V19l4 2v-8.54l.9-1.055",key:"1fi1da"}],["path",{d:"m22 3-5 5",key:"12jva0"}],["path",{d:"m17 3 5 5",key:"k36vhe"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=N("Hourglass",[["path",{d:"M5 22h14",key:"ehvnwv"}],["path",{d:"M5 2h14",key:"pdyrp9"}],["path",{d:"M17 22v-4.172a2 2 0 0 0-.586-1.414L12 12l-4.414 4.414A2 2 0 0 0 7 17.828V22",key:"1d314k"}],["path",{d:"M7 2v4.172a2 2 0 0 0 .586 1.414L12 12l4.414-4.414A2 2 0 0 0 17 6.172V2",key:"1vvvr6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=N("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=N("ShieldAlert",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=N("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);function vs(){var ke,Ne;const{toast:o}=Ke(),[_,v]=n.useState([]),[S,C]=n.useState(!0),[i,L]=n.useState(null),[r,g]=n.useState(null),[f,re]=n.useState(!1),[ne]=n.useState(!0),[ie,Pe]=n.useState(null),[He,F]=n.useState(!1),[Oe,R]=n.useState(!1),[d,de]=n.useState(null),[h,ce]=n.useState(null),[V,E]=n.useState(""),[m,U]=n.useState(null),[$,oe]=n.useState(""),[I,me]=n.useState("all"),[w,xe]=n.useState(!1),[z,he]=n.useState("default"),[Fe,ue]=n.useState(!1),pe=n.useCallback(()=>y(this,null,function*(){var s,t;try{C(!0);const a=yield T.getTests({per_page:100,sort_by:"start_time",sort_order:"desc",status:"active"}),l=Array.isArray(a==null?void 0:a.data)?a.data:a;v(l),!i&&l.length>0&&L(l[0].id)}catch(a){o({title:"Gagal memuat ujian",description:((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Terjadi kesalahan saat memuat data",variant:"destructive"})}finally{C(!1)}}),[i,o]),j=n.useCallback((s=!1)=>y(this,null,function*(){var t,a;if(i)try{s||re(!0);const l=yield T.getTestMonitor(i);g(l),Pe(new Date)}catch(l){o({title:"Gagal memuat monitoring",description:((a=(t=l.response)==null?void 0:t.data)==null?void 0:a.message)||"Tidak dapat mengambil data monitoring saat ini",variant:"destructive"})}finally{s||re(!1)}}),[i,o]);n.useEffect(()=>{pe()},[pe]),n.useEffect(()=>{i&&j()},[i,j]),n.useEffect(()=>{if(!i||!ne)return;const s=setInterval(()=>{j(!0)},6e4);return()=>clearInterval(s)},[i,ne,j]);const Re=n.useMemo(()=>{var a;const s=(a=r==null?void 0:r.attempts)!=null?a:[],t={total:0,inProgress:0,completed:0,blocked:0,notStarted:0};return s.forEach(l=>{t.total+=1,l.status==="not_started"?t.notStarted+=1:l.is_blocked||l.status==="blocked"?t.blocked+=1:l.status==="completed"?t.completed+=1:t.inProgress+=1}),t},[r]),ge=s=>{de(s),E(""),F(!0)},je=s=>{ce(s),R(!0)},G=()=>{F(!1),de(null),E("")},K=()=>{R(!1),ce(null)},be=s=>s?We(new Date(s),{addSuffix:!0,locale:Ye}):"-",fe=s=>s.status==="not_started"?e.jsx(p,{variant:"outline",className:"border-dashed border-amber-500 bg-amber-50 text-amber-600",children:"Belum memulai"}):s.is_blocked||s.status==="blocked"?e.jsx(p,{variant:"outline",className:"border-red-500 bg-red-50 text-red-600",children:"Diblokir"}):s.status==="completed"?e.jsx(p,{variant:"outline",className:"border-emerald-500 bg-emerald-50 text-emerald-600",children:"Selesai"}):e.jsx(p,{variant:"outline",className:"border-blue-500 bg-blue-50 text-blue-600",children:"Sedang berlangsung"}),Ve=()=>y(this,null,function*(){var s,t;if(!(!d||d.id==null))try{U(d.id),yield T.blockAttempt(d.id,V.trim()?V.trim():void 0),o({title:"Attempt diblokir",description:`${d.student.name} tidak dapat melanjutkan ujian sampai dibuka kembali`}),G(),yield j(!0)}catch(a){o({title:"Gagal memblokir attempt",description:((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Terjadi kesalahan saat memblokir attempt",variant:"destructive"})}finally{U(null)}}),Ee=()=>y(this,null,function*(){var s,t;if(!(!h||h.id==null))try{U(h.id),yield T.unblockAttempt(h.id),o({title:"Attempt dibuka",description:`${h.student.name} dapat melanjutkan ujian`}),K(),yield j(!0)}catch(a){o({title:"Gagal membuka blokir",description:((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Terjadi kesalahan saat membuka blokir attempt",variant:"destructive"})}finally{U(null)}}),A={total:{label:"Total Peserta",description:"Jumlah peserta terdaftar",icon:e.jsx(se,{className:"h-5 w-5"}),gradient:"from-blue-500 to-purple-500"},inProgress:{label:"Sedang Berlangsung",description:"Attempt aktif saat ini",icon:e.jsx(ae,{className:"h-5 w-5"}),gradient:"from-sky-500 to-cyan-500"},completed:{label:"Selesai",description:"Attempt yang sudah selesai",icon:e.jsx(ee,{className:"h-5 w-5"}),gradient:"from-emerald-500 to-green-500"},blocked:{label:"Diblokir",description:"Attempt yang diblokir pengawas",icon:e.jsx(Ie,{className:"h-5 w-5"}),gradient:"from-rose-500 to-red-500"},notStarted:{label:"Belum Mulai",description:"Siswa belum memulai ujian",icon:e.jsx(ss,{className:"h-5 w-5"}),gradient:"from-amber-500 to-orange-500"}},P=(ke=r==null?void 0:r.attempts)!=null?ke:[],$e=n.useMemo(()=>{const s=new Set;return P.forEach(t=>{var l,c;const a=(c=(l=t.student)==null?void 0:l.class_name)==null?void 0:c.trim();a&&s.add(a)}),Array.from(s).sort()},[P]),H=n.useMemo(()=>{const s=$.toLowerCase();let t=P.filter(a=>{var x,ve,we,ye;const l=s?(((x=a.student)==null?void 0:x.name)||"").toLowerCase().includes(s)||(((ve=a.student)==null?void 0:ve.email)||"").toLowerCase().includes(s)||(((we=a.student)==null?void 0:we.nisn)||"").toLowerCase().includes(s):!0,c=I==="all"||((ye=a.student)==null?void 0:ye.class_name)===I,u=w?a.is_blocked||a.status==="blocked":!0;return l&&c&&u});return z==="progress"&&(t=[...t].sort((a,l)=>{var c,u;return((c=l.progress_percent)!=null?c:0)-((u=a.progress_percent)!=null?u:0)})),t},[P,$,I,w,z]),ze=()=>{oe(""),me("all"),xe(!1),he("default")},Ge=s=>y(this,null,function*(){var t,a;if(!(!i||!(r!=null&&r.test)))try{ue(!0),yield T.updateTest(i,{cheat_detection_enabled:s}),yield j(!0),o({title:s?"Deteksi kecurangan diaktifkan":"Deteksi kecurangan dinonaktifkan",description:s?"Sistem akan memblokir otomatis setelah 3 pelanggaran":"Pemblokiran hanya dapat dilakukan secara manual"})}catch(l){o({title:"Gagal mengubah pengaturan",description:((a=(t=l.response)==null?void 0:t.data)==null?void 0:a.message)||"Terjadi kesalahan pada sistem",variant:"destructive"}),yield j(!0)}finally{ue(!1)}});return e.jsxs("div",{className:"p-2 sm:p-3 md:p-6 space-y-4 md:space-y-6 pb-24 md:pb-6 overflow-x-hidden",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:gap-3 md:gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-lg sm:text-xl md:text-3xl font-bold tracking-tight",children:"Monitoring Ujian"}),e.jsx("p",{className:"mt-1 text-[10px] sm:text-xs md:text-sm text-muted-foreground truncate",children:"Pantau progres realtime siswa"}),ie&&e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5 sm:mt-2",children:[e.jsx("div",{className:"h-1.5 w-1.5 sm:h-2 sm:w-2 rounded-full bg-emerald-500 animate-pulse"}),e.jsxs("p",{className:"text-[9px] sm:text-[10px] md:text-xs text-muted-foreground",children:["Update: ",O(ie,"HH:mm:ss")]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[e.jsx("div",{className:"w-full sm:w-56 md:w-64",children:e.jsxs(Q,{value:i?String(i):"",onValueChange:s=>L(Number(s)),disabled:S||_.length===0,children:[e.jsx(W,{id:"monitoring-test-select",className:"h-8 sm:h-9 md:h-10 text-xs sm:text-sm bg-white dark:bg-slate-900",children:e.jsx(Y,{placeholder:S?"Memuat...":"Pilih Jadwal Ujian"})}),e.jsx(Z,{children:_.map(s=>e.jsx(D,{value:String(s.id),children:e.jsx("span",{className:"font-medium",children:s.title})},s.id))})]})}),e.jsxs(k,{variant:"outline",onClick:()=>j(),disabled:!i||f,className:"h-8 sm:h-9 md:h-10 text-xs sm:text-sm bg-white dark:bg-slate-900",children:[f?e.jsx(b,{className:"mr-1.5 sm:mr-2 h-3 w-3 sm:h-3.5 sm:w-3.5 animate-spin"}):e.jsx(as,{className:"mr-1.5 sm:mr-2 h-3 w-3 sm:h-3.5 sm:w-3.5"}),"Refresh"]})]})]}),!S&&_.length===0?e.jsx(B,{children:e.jsxs(q,{children:[e.jsx(J,{children:"Tidak ada ujian"}),e.jsx(_e,{children:"Belum ada ujian yang dapat dimonitor. Buat ujian terlebih dahulu untuk mulai memantau aktivitas siswa."})]})}):e.jsxs(e.Fragment,{children:[(r==null?void 0:r.test)&&e.jsx(B,{children:e.jsx(q,{className:"px-3 sm:px-6",children:e.jsxs("div",{className:"flex flex-col gap-2 sm:gap-3",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx(J,{className:"text-sm sm:text-base md:text-lg line-clamp-2",children:r.test.title})}),e.jsxs(p,{variant:"outline",className:"border-slate-200 flex-shrink-0 text-[10px] sm:text-xs",children:["#",r.test.id]})]}),r.test.is_remedial&&e.jsxs(p,{className:"bg-blue-600 hover:bg-blue-700 w-fit text-[10px] sm:text-xs",children:["Remidi (",r.test.allowed_students_count," siswa)"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 rounded-lg border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50 p-2.5 sm:p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(Xe,{id:"cheat-detection",checked:(Ne=r.test.cheat_detection_enabled)!=null?Ne:!0,onCheckedChange:Ge,disabled:Fe}),e.jsxs("div",{className:"flex flex-col flex-1 min-w-0",children:[e.jsx(qe,{htmlFor:"cheat-detection",className:"text-xs sm:text-sm font-semibold cursor-pointer",children:"Deteksi Kecurangan"}),e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground line-clamp-2",children:r.test.cheat_detection_enabled?"Blokir otomatis setelah 3 pelanggaran":"Pemblokiran manual oleh pengawas"})]})]}),e.jsx(p,{variant:r.test.cheat_detection_enabled?"default":"outline",className:M("flex-shrink-0 text-xs",r.test.cheat_detection_enabled?"bg-emerald-600 hover:bg-emerald-700":"border-slate-300 text-slate-600 dark:border-slate-600 dark:text-slate-400"),children:r.test.cheat_detection_enabled?"AKTIF":"NONAKTIF"})]})]})})}),e.jsx("div",{className:"grid grid-cols-2 gap-2 sm:gap-3 md:gap-4 md:grid-cols-2 xl:grid-cols-5",children:Object.keys(A).map(s=>e.jsx(B,{className:"overflow-hidden",children:e.jsx(X,{className:"p-2.5 sm:p-3 md:p-5",children:e.jsxs("div",{className:"flex items-start justify-between gap-1.5 sm:gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-[9px] sm:text-[10px] md:text-xs font-semibold uppercase text-slate-500 truncate",children:A[s].label}),e.jsx("p",{className:"mt-1 md:mt-2 text-lg sm:text-xl md:text-3xl font-bold",children:Re[s]}),e.jsx("p",{className:"mt-0.5 md:mt-1 text-[9px] sm:text-[10px] md:text-xs text-muted-foreground line-clamp-2",children:A[s].description})]}),e.jsx("div",{className:M("flex h-7 w-7 sm:h-8 sm:w-8 md:h-10 md:w-10 items-center justify-center rounded-full bg-gradient-to-br text-white shadow-sm flex-shrink-0",A[s].gradient),children:e.jsx("div",{className:"scale-[0.65] sm:scale-75 md:scale-100",children:A[s].icon})})]})})},s))}),e.jsxs(B,{children:[e.jsxs(q,{className:"pb-2 sm:pb-3 px-3 sm:px-6",children:[e.jsx(J,{className:"text-sm sm:text-base md:text-lg",children:"Status Pengerjaan"}),e.jsx(_e,{className:"text-[10px] sm:text-xs md:text-sm line-clamp-2",children:"Daftar attempt siswa diperbarui otomatis setiap 15 detik."}),e.jsxs("div",{className:"mt-2 sm:mt-3 md:mt-4 grid grid-cols-1 sm:grid-cols-2 gap-2 md:gap-3",children:[e.jsx("div",{className:"relative sm:col-span-2 md:col-span-1",children:e.jsx(Je,{placeholder:"Cari siswa...",value:$,onChange:s=>oe(s.target.value),className:"pl-3 h-8 sm:h-9 md:h-10 text-xs sm:text-sm"})}),e.jsx("div",{children:e.jsxs(Q,{value:I,onValueChange:s=>me(s),children:[e.jsx(W,{className:"h-8 sm:h-9 md:h-10 text-xs sm:text-sm",children:e.jsx(Y,{placeholder:"Filter kelas"})}),e.jsxs(Z,{children:[e.jsx(D,{value:"all",children:"Semua Kelas"}),$e.map(s=>e.jsx(D,{value:s,children:s},s))]})]})})]}),e.jsxs("div",{className:"mt-2 md:mt-3 flex flex-wrap items-center gap-1.5 sm:gap-2",children:[e.jsxs(k,{variant:w?"default":"outline",size:"sm",onClick:()=>xe(!w),className:M("text-[10px] sm:text-[11px] md:text-xs h-7 sm:h-8 md:h-9 px-2 sm:px-3",w&&"bg-red-600 hover:bg-red-700 text-white"),children:[e.jsx(Ie,{className:"mr-1 h-3 w-3 md:h-3.5 md:w-3.5"}),w?"Semua":"Diblokir"]}),e.jsxs(Q,{value:z,onValueChange:s=>he(s),children:[e.jsxs(W,{className:"w-[110px] sm:w-[140px] md:w-[160px] h-7 sm:h-8 md:h-9 text-[10px] sm:text-[11px] md:text-xs",children:[e.jsx(Ze,{className:"mr-1 h-3 w-3 md:h-3.5 md:w-3.5"}),e.jsx(Y,{placeholder:"Urutkan"})]}),e.jsxs(Z,{children:[e.jsx(D,{value:"default",children:"Default"}),e.jsx(D,{value:"progress",children:"Progres"})]})]}),e.jsxs(k,{variant:"ghost",size:"sm",onClick:ze,className:"text-[10px] sm:text-[11px] md:text-xs text-muted-foreground hover:text-foreground h-7 sm:h-8 md:h-9 px-2 sm:px-3",children:[e.jsx(es,{className:"mr-1 h-3 w-3 md:h-3.5 md:w-3.5"}),"Reset"]})]})]}),e.jsxs(X,{className:"p-2 sm:p-3 md:p-4",children:[e.jsx("div",{className:"hidden md:block w-full border-t border-slate-200 dark:border-slate-800",children:e.jsx("div",{className:"w-full overflow-x-auto pb-4",children:e.jsx("div",{className:"min-w-[1000px]",children:e.jsxs("table",{className:"w-full text-sm border-collapse",children:[e.jsx("thead",{className:"bg-slate-100 dark:bg-slate-800 text-left text-xs uppercase tracking-wide text-slate-600 dark:text-slate-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 whitespace-nowrap border-r border-slate-200 dark:border-slate-700 bg-slate-100 dark:bg-slate-800",children:"Peserta"}),e.jsx("th",{className:"px-4 py-3 whitespace-nowrap",children:"Status"}),e.jsx("th",{className:"px-4 py-3 whitespace-nowrap",children:"Progres"}),e.jsx("th",{className:"px-4 py-3 whitespace-nowrap",children:"Aktivitas & Pelanggaran"}),e.jsx("th",{className:"px-4 py-3 text-right whitespace-nowrap",children:"Aksi"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-800 bg-white dark:bg-slate-900",children:f?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-20 text-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 text-muted-foreground",children:[e.jsx(b,{className:"h-8 w-8 animate-spin text-blue-500"}),e.jsx("p",{children:"Memuat data monitoring..."})]})})}):H.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-20 text-center text-sm text-muted-foreground",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx(se,{className:"h-10 w-10 text-slate-300"}),e.jsx("p",{children:"Tidak ada data siswa yang cocok."})]})})}):H.map(s=>{var t,a,l,c,u;return e.jsxs("tr",{className:"transition-colors hover:bg-slate-50 dark:hover:bg-slate-800 group",children:[e.jsx("td",{className:"px-4 py-3 align-top border-r border-slate-100 dark:border-slate-800 bg-white dark:bg-slate-900",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("div",{className:"font-semibold text-sm text-slate-800 dark:text-slate-100 whitespace-nowrap",children:s.student.name}),e.jsxs("div",{className:"flex flex-col text-xs text-muted-foreground",children:[e.jsx("span",{children:s.student.nisn}),s.student.class_name&&e.jsx("span",{className:"text-[10px] bg-slate-100 dark:bg-slate-800 px-1.5 py-0.5 rounded w-fit mt-1",children:s.student.class_name})]})]})}),e.jsx("td",{className:"px-4 py-3 align-top",children:e.jsxs("div",{className:"flex flex-col gap-1.5",children:[fe(s),s.status_label&&e.jsx("span",{className:"text-[10px] text-muted-foreground",children:s.status_label}),s.started_at&&e.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-slate-500",children:[e.jsx(ae,{className:"h-3 w-3"}),O(new Date(s.started_at),"HH:mm")]})]})}),e.jsxs("td",{className:"px-4 py-3 align-top min-w-[160px]",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs font-medium mb-1.5",children:[e.jsxs("span",{className:"text-slate-600 dark:text-slate-300",children:[s.answered_count," /"," ",s.total_questions]}),e.jsxs("span",{className:"text-blue-600 dark:text-blue-400",children:[s.progress_percent,"%"]})]}),e.jsx("div",{className:"h-2 w-full overflow-hidden rounded-full bg-slate-100 dark:bg-slate-800",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-indigo-500 transition-all duration-500",style:{width:`${s.progress_percent}%`}})}),e.jsxs("p",{className:"mt-1.5 text-[10px] text-slate-500 truncate",children:["Last active:"," ",be(s.last_activity_at)]})]}),e.jsx("td",{className:"px-4 py-3 align-top",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(p,{variant:"outline",className:M("text-[10px] font-normal h-5 px-1.5",s.cheat_count&&s.cheat_count>=3?"border-red-200 bg-red-50 text-red-600":s.cheat_count&&s.cheat_count>0?"border-amber-200 bg-amber-50 text-amber-600":"border-slate-200 text-slate-500"),children:[e.jsx(Ue,{className:"mr-1 h-3 w-3"}),s.cheat_count||0," Pelanggaran"]})}),((t=s.events)!=null?t:[]).length>0&&e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800/50 rounded p-2 text-[10px] text-slate-600 dark:text-slate-400 space-y-1 max-w-[200px] border border-slate-100 dark:border-slate-700",children:[((a=s.events)!=null?a:[]).slice(0,2).map(x=>e.jsxs("div",{className:"line-clamp-1",title:x.description||x.event_type,children:[e.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-300",children:x.event_type}),e.jsx("span",{className:"mx-1",children:"·"}),O(new Date(x.created_at),"HH:mm")]},x.id)),((l=s.events)!=null?l:[]).length>2&&e.jsxs("div",{className:"text-center text-xs text-blue-500 cursor-pointer hover:underline",children:["+",((c=s.events)!=null?c:[]).length-2," ","lainnya"]})]})]})}),e.jsx("td",{className:"px-4 py-3 align-top text-right",children:e.jsx("div",{className:"flex justify-end",children:s.id?s.is_blocked?e.jsxs(k,{size:"sm",variant:"outline",onClick:()=>je(s),disabled:m===s.id,className:"h-8 text-xs border-emerald-200 text-emerald-600 hover:bg-emerald-50 hover:text-emerald-700",children:[m===s.id?e.jsx(b,{className:"h-3.5 w-3.5 animate-spin"}):e.jsx(le,{className:"mr-1.5 h-3.5 w-3.5"}),"Buka"]}):s.status==="completed"?e.jsxs("span",{className:"text-xs font-medium text-emerald-600 flex items-center justify-end gap-1",children:[e.jsx(ee,{className:"h-3.5 w-3.5"})," ","Selesai"]}):e.jsxs(k,{size:"sm",variant:"outline",onClick:()=>ge(s),disabled:m===s.id,className:"h-8 text-xs border-red-200 text-red-600 hover:bg-red-50 hover:text-red-700",children:[m===s.id?e.jsx(b,{className:"h-3.5 w-3.5 animate-spin"}):e.jsx(te,{className:"mr-1.5 h-3.5 w-3.5"}),"Blokir"]}):e.jsx("span",{className:"text-xs text-slate-400 italic",children:"Menunggu"})})})]},`attempt-${s.student.id}-${(u=s.id)!=null?u:"pending"}`)})})]})})})}),e.jsx("div",{className:"md:hidden space-y-2.5",children:f?e.jsx("div",{className:"py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 text-muted-foreground",children:[e.jsx(b,{className:"h-8 w-8 animate-spin text-blue-500"}),e.jsx("p",{className:"text-sm",children:"Memuat data monitoring..."})]})}):H.length===0?e.jsx("div",{className:"py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx(se,{className:"h-10 w-10 text-slate-300"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Tidak ada data siswa yang cocok."})]})}):H.map(s=>{var t,a,l,c,u;return e.jsx(B,{className:"overflow-hidden",children:e.jsxs(X,{className:"p-3 space-y-2.5",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-xs truncate",children:s.student.name}),e.jsx("p",{className:"text-[10px] text-muted-foreground truncate",children:s.student.nisn}),s.student.class_name&&e.jsx(p,{variant:"outline",className:"mt-1 text-[9px] h-4 px-1.5",children:s.student.class_name})]}),e.jsx("div",{className:"flex-shrink-0",children:fe(s)})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-xs font-medium mb-1.5",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-300 text-[10px]",children:"Progres"}),e.jsxs("span",{className:"text-blue-600 dark:text-blue-400 text-[10px]",children:[s.answered_count,"/",s.total_questions," ","(",s.progress_percent,"%)"]})]}),e.jsx("div",{className:"h-2 w-full overflow-hidden rounded-full bg-slate-100 dark:bg-slate-800",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-indigo-500 transition-all duration-500",style:{width:`${s.progress_percent}%`}})})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(p,{variant:"outline",className:M("text-[9px] font-normal h-5 px-1.5 w-fit",s.cheat_count&&s.cheat_count>=3?"border-red-200 bg-red-50 text-red-600 dark:bg-red-950 dark:text-red-400":s.cheat_count&&s.cheat_count>0?"border-amber-200 bg-amber-50 text-amber-600 dark:bg-amber-950 dark:text-amber-400":"border-slate-200 text-slate-500"),children:[e.jsx(Ue,{className:"mr-0.5 h-2.5 w-2.5"}),s.cheat_count||0," Pelanggaran"]}),((t=s.events)!=null?t:[]).length>0&&e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800/50 rounded p-1.5 text-[9px] text-slate-600 dark:text-slate-400 space-y-0.5 border border-slate-100 dark:border-slate-700",children:[((a=s.events)!=null?a:[]).slice(0,2).map(x=>e.jsxs("div",{className:"line-clamp-1 truncate",children:[e.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-300",children:x.event_type}),e.jsx("span",{className:"mx-1",children:"·"}),O(new Date(x.created_at),"HH:mm")]},x.id)),((l=s.events)!=null?l:[]).length>2&&e.jsxs("div",{className:"text-center text-[9px] text-blue-500",children:["+",((c=s.events)!=null?c:[]).length-2," lagi"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-[9px] text-slate-500 truncate",children:[e.jsx(ae,{className:"h-2.5 w-2.5 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:be(s.last_activity_at)})]})]}),e.jsx("div",{className:"pt-2 border-t border-slate-100 dark:border-slate-800",children:s.id?s.is_blocked?e.jsxs(k,{size:"sm",variant:"outline",onClick:()=>je(s),disabled:m===s.id,className:"w-full h-8 text-[10px] border-emerald-200 text-emerald-600 hover:bg-emerald-50 hover:text-emerald-700",children:[m===s.id?e.jsx(b,{className:"h-3 w-3 animate-spin"}):e.jsx(le,{className:"mr-1 h-3 w-3"}),"Buka Blokir"]}):s.status==="completed"?e.jsx("div",{className:"text-center py-1.5",children:e.jsxs("span",{className:"text-[10px] font-medium text-emerald-600 flex items-center justify-center gap-1",children:[e.jsx(ee,{className:"h-3 w-3"}),"Selesai"]})}):e.jsxs(k,{size:"sm",variant:"outline",onClick:()=>ge(s),disabled:m===s.id,className:"w-full h-8 text-[10px] border-red-200 text-red-600 hover:bg-red-50 hover:text-red-700",children:[m===s.id?e.jsx(b,{className:"h-3 w-3 animate-spin"}):e.jsx(te,{className:"mr-1 h-3 w-3"}),"Blokir Siswa"]}):e.jsx("span",{className:"text-[10px] text-slate-400 italic block text-center",children:"Menunggu memulai"})})]})},`mobile-attempt-${s.student.id}-${(u=s.id)!=null?u:"pending"}`)})})]})]})]}),e.jsx(Se,{open:He,onOpenChange:s=>s?F(!0):G(),children:e.jsxs(Ce,{children:[e.jsxs(Ae,{children:[e.jsx(Be,{children:"Blokir attempt siswa?"}),e.jsx(Me,{children:"Siswa tidak akan dapat melanjutkan pengerjaan sampai Anda membuka blokir. Tambahkan catatan jika diperlukan."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm font-semibold text-slate-700",children:["Target: ",d==null?void 0:d.student.name]}),e.jsx(Qe,{placeholder:"Alasan pemblokiran (opsional)",value:V,onChange:s=>E(s.target.value)})]}),e.jsxs(De,{children:[e.jsx(Te,{onClick:G,children:"Batal"}),e.jsxs(Le,{onClick:Ve,disabled:m===(d==null?void 0:d.id),className:"bg-red-600 hover:bg-red-700",children:[m===(d==null?void 0:d.id)?e.jsx(b,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(te,{className:"mr-2 h-4 w-4"}),"Blokir sekarang"]})]})]})}),e.jsx(Se,{open:Oe,onOpenChange:s=>s?R(!0):K(),children:e.jsxs(Ce,{children:[e.jsxs(Ae,{children:[e.jsx(Be,{children:"Buka blokir attempt?"}),e.jsx(Me,{children:"Siswa akan dapat melanjutkan pengerjaan ujian selama waktu ujian masih berlangsung."})]}),e.jsxs(De,{children:[e.jsx(Te,{onClick:K,children:"Batal"}),e.jsxs(Le,{onClick:Ee,disabled:m===(h==null?void 0:h.id),className:"bg-emerald-600 hover:bg-emerald-700",children:[m===(h==null?void 0:h.id)?e.jsx(b,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(le,{className:"mr-2 h-4 w-4"}),"Buka blokir"]})]})]})})]})}export{vs as default};
